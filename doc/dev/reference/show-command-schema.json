{
  "$schema": "http://json-schema.org/draft-07/schema#",
  "title": "Beads Issue Details Schema",
  "description": "Schema for the JSON output of the 'bd show --json' command in direct mode.",
  "type": "array",
  "items": {
    "$ref": "#/$defs/issueDetails"
  },
  "$defs": {
    "issueDetails": {
      "type": "object",
      "description": "Represents a single issue with its full details.",
      "allOf": [
        {
          "$ref": "#/$defs/issue"
        }
      ],
      "properties": {
        "labels": {
          "type": "array",
          "items": {
            "type": "string"
          },
          "description": "A list of labels associated with the issue."
        },
        "dependencies": {
          "type": "array",
          "items": {
            "$ref": "#/$defs/issueWithDependencyMetadata"
          },
          "description": "A list of issues that this issue depends on."
        },
        "dependents": {
          "type": "array",
          "items": {
            "$ref": "#/$defs/issueWithDependencyMetadata"
          },
          "description": "A list of issues that depend on this issue."
        },
        "comments": {
          "type": "array",
          "items": {
            "$ref": "#/$defs/comment"
          },
          "description": "A list of comments on the issue."
        }
      },
      "required": [
        "id",
        "title",
        "status",
        "priority",
        "issue_type",
        "created_at",
        "updated_at"
      ]
    },
    "issue": {
      "type": "object",
      "description": "Core fields representing a trackable work item.",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the issue."
        },
        "title": {
          "type": "string",
          "description": "The title of the issue."
        },
        "description": {
          "type": "string",
          "description": "A detailed description of the issue."
        },
        "design": {
          "type": "string",
          "description": "Notes on the design or implementation plan."
        },
        "acceptance_criteria": {
          "type": "string",
          "description": "Criteria that must be met for the issue to be considered done."
        },
        "notes": {
          "type": "string",
          "description": "Additional notes or context."
        },
        "status": {
          "type": "string",
          "enum": [
            "open",
            "in_progress",
            "blocked",
            "closed"
          ],
          "description": "The current status of the issue."
        },
        "priority": {
          "type": "integer",
          "minimum": 0,
          "maximum": 4,
          "description": "Priority level (0-4)."
        },
        "issue_type": {
          "type": "string",
          "enum": [
            "bug",
            "feature",
            "task",
            "epic",
            "chore"
          ],
          "description": "The type of issue."
        },
        "assignee": {
          "type": "string",
          "description": "The person assigned to the issue."
        },
        "estimated_minutes": {
          "type": [
            "integer",
            "null"
          ],
          "description": "Estimated time in minutes to complete the issue."
        },
        "created_at": {
          "type": "string",
          "format": "date-time",
          "description": "The timestamp when the issue was created."
        },
        "updated_at": {
          "type": "string",
          "format": "date-time",
          "description": "The timestamp when the issue was last updated."
        },
        "closed_at": {
          "type": [
            "string",
            "null"
          ],
          "format": "date-time",
          "description": "The timestamp when the issue was closed."
        },
        "close_reason": {
          "type": "string",
          "description": "The reason the issue was closed."
        },
        "external_ref": {
          "type": [
            "string",
            "null"
          ],
          "description": "A reference to an external system (e.g., GitHub issue)."
        },
        "compaction_level": {
          "type": "integer",
          "description": "The level of content compaction applied."
        },
        "compacted_at": {
          "type": [
            "string",
            "null"
          ],
          "format": "date-time",
          "description": "The timestamp when compaction was performed."
        },
        "compacted_at_commit": {
          "type": [
            "string",
            "null"
          ],
          "description": "The Git commit hash when the issue was compacted."
        },
        "original_size": {
          "type": "integer",
          "description": "The size of the issue content in bytes before compaction."
        }
      }
    },
    "issueWithDependencyMetadata": {
      "type": "object",
      "description": "An issue that is a dependency, extended with metadata about the relationship.",
      "allOf": [
        {
          "$ref": "#/$defs/issue"
        }
      ],
      "properties": {
        "dependency_type": {
          "type": "string",
          "enum": [
            "blocks",
            "related",
            "parent-child",
            "discovered-from"
          ],
          "description": "The type of dependency relationship."
        }
      }
    },
    "comment": {
      "type": "object",
      "description": "A comment made on an issue.",
      "properties": {
        "id": {
          "type": "integer",
          "description": "Unique identifier for the comment."
        },
        "issue_id": {
          "type": "string",
          "description": "The ID of the issue the comment belongs to."
        },
        "author": {
          "type": "string",
          "description": "The author of the comment."
        },
        "text": {
          "type": "string",
          "description": "The content of the comment."
        },
        "created_at": {
          "type": "string",
          "format": "date-time",
          "description": "The timestamp when the comment was created."
        }
      },
      "required": [
        "id",
        "issue_id",
        "author",
        "text",
        "created_at"
      ]
    }
  }
}
