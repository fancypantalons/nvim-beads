{"id":"nvim-beads-a1g","title":"Create :Beads user command","description":"Define the :Beads command in plugin/nvim-beads.lua that invokes the Telescope picker, and document the telescope extension loading requirement.","status":"closed","priority":1,"issue_type":"task","created_at":"2025-11-30T17:08:48.808646329-07:00","updated_at":"2025-11-30T18:19:55.921334476-07:00","closed_at":"2025-11-30T18:19:55.921334476-07:00","dependencies":[{"issue_id":"nvim-beads-a1g","depends_on_id":"nvim-beads-k8m","type":"blocks","created_at":"2025-11-30T17:09:22.380046288-07:00","created_by":"daemon"}]}
{"id":"nvim-beads-a6r","title":"Remove old internal code paths after API migration","description":"Clean up backward-compatibility shims and old internal functions that were kept during the API migration. This is a breaking change suitable for a major version bump.","status":"closed","priority":3,"issue_type":"task","created_at":"2025-12-06T11:50:29.224060495-07:00","updated_at":"2025-12-06T20:38:52.81074559-07:00","closed_at":"2025-12-06T20:38:52.81074559-07:00","dependencies":[{"issue_id":"nvim-beads-a6r","depends_on_id":"nvim-beads-4gh","type":"parent-child","created_at":"2025-12-06T11:50:29.235143052-07:00","created_by":"daemon"},{"issue_id":"nvim-beads-a6r","depends_on_id":"nvim-beads-766","type":"blocks","created_at":"2025-12-06T11:50:50.602832518-07:00","created_by":"daemon"}]}
{"id":"nvim-beads-esz","title":"Add unit tests for issue formatter","description":"Create comprehensive unit tests for the format_issue_to_markdown function in spec/nvim-beads/issue_spec.lua using busted test framework.","status":"closed","priority":1,"issue_type":"task","created_at":"2025-11-30T18:24:30.762150142-07:00","updated_at":"2025-11-30T18:48:41.020440616-07:00","closed_at":"2025-11-30T18:48:41.020440616-07:00","dependencies":[{"issue_id":"nvim-beads-esz","depends_on_id":"nvim-beads-akf","type":"blocks","created_at":"2025-11-30T18:24:46.13676299-07:00","created_by":"daemon"}]}
{"id":"nvim-beads-p66","title":"Refactor list and ready commands to use new execute infrastructure","description":"Core.lua changes:\n- Refactor show_list(opts) to build bd_args and filter table from supplied opts and call show_issues()\n- Refactor show_ready(opts) to build bd_args and filter table from supplied opts and call show_issues()\n\nCommands.lua changes:\n- Update list subcommand to build bd_args and filter table from parsed status/type and call execute_with_ui()\n- Keep syntactic sugar parsing (open, bugs, etc.)\n\nAcceptance criteria:\n- :Beads list open bugs still works (syntactic sugar preserved)\n- :Beads ready bugs still works\n- Both use new infrastructure under the hood\n- Refresh still works after mutations","status":"closed","priority":1,"issue_type":"task","created_at":"2025-12-06T22:47:25.023086984-07:00","updated_at":"2025-12-06T23:50:23.649530099-07:00","closed_at":"2025-12-06T23:50:23.649530099-07:00","dependencies":[{"issue_id":"nvim-beads-p66","depends_on_id":"nvim-beads-bec","type":"blocks","created_at":"2025-12-06T22:48:30.587009483-07:00","created_by":"daemon"}]}
{"id":"nvim-beads-mvy","title":"Implement Telescope hotkey to open issues","description":"Create a feature to allow users to mark a selected `beads` issue as \"open\" directly from the Telescope issue list.\n\n**Implementation Details**:\n-   **Telescope Custom Mapping**: Add a normal mode keymap ('o') within the `beads` Telescope picker.\n-   **Selected Entry Retrieval**: The Lua function will retrieve the currently selected issue entry from the Telescope picker using `require('telescope.actions.state').get_selected_entry()`.\n-   **User Confirmation**: A confirmation dialog via `vim.fn.confirm()` must be shown before changing the status.\n-   **Asynchronous Update**: Upon confirmation, execute `bd update \u003cissue_id\u003e --status open --json` using `vim.system()`.\n-   **Picker Refresh**: After a successful update, the Telescope picker list must be refreshed to reflect the status change.","status":"closed","priority":1,"issue_type":"feature","created_at":"2025-12-02T21:24:53.934404832-07:00","updated_at":"2025-12-02T21:41:27.962624086-07:00","closed_at":"2025-12-02T21:41:27.962624086-07:00"}
{"id":"nvim-beads-2s3","title":"Consolidate duplicated newline-splitting logic into a shared utility function","description":"### Observation\n\nThe logic to split a multi-line string into a table of individual lines is implemented identically in multiple places, specifically:\n- `autocmds.lua` (in `handle_new_issue_save` and `handle_existing_issue_save`)\n- `issue.lua` (in `open_issue_buffer` and `open_new_issue_buffer`)\n\nThis code duplication makes the code harder to maintain.\n\n### Recommendation\n\n1.  Create a new utility module at `lua/nvim-beads/util.lua`.\n2.  Implement a function within this module, such as `M.split_multiline_string(str)`, that takes a string as input and returns a table of lines.\n3.  Replace the duplicated logic in `autocmds.lua` and `issue.lua` with calls to this new shared utility function.\n4.  Ensure the new function correctly handles empty strings, strings with no newlines, and strings with leading/trailing newlines.\n\n### Verification\n\n1.  All existing unit tests should continue to pass.\n2.  Create a new test file, `spec/nvim-beads/util_spec.lua`, with specific unit tests for the `split_multiline_string` function to cover various edge cases.\n3.  Manually test the save workflow (`:w` in a `beads://` buffer) for issues that have multi-line content in fields like `description` or `notes`. Verify that the content is parsed, saved, and reloaded into the buffer correctly without being altered.","status":"closed","priority":3,"issue_type":"task","created_at":"2025-12-01T20:52:08.466249715-07:00","updated_at":"2025-12-02T18:15:55.254347081-07:00","closed_at":"2025-12-02T18:15:55.254347081-07:00"}
{"id":"nvim-beads-5fu","title":"Adopt parameterized testing patterns more aggressively","description":"Some tests use parameterized/table-driven patterns well (diff_spec.lua), but many files still have repetitive test cases that could be consolidated.\n\nTarget patterns:\n- Multiple tests with identical structure but different inputs\n- \"Happy path\" variations that just change one parameter\n- Error handling tests with same structure but different invalid inputs\n\nEstimated savings: 200-300 lines.","status":"open","priority":3,"issue_type":"task","created_at":"2025-12-07T18:15:49.100520413-07:00","updated_at":"2025-12-07T18:15:49.100520413-07:00","dependencies":[{"issue_id":"nvim-beads-5fu","depends_on_id":"nvim-beads-pkk","type":"blocks","created_at":"2025-12-07T18:16:29.127300773-07:00","created_by":"daemon"}]}
{"id":"nvim-beads-kag","title":"Add core.show_search() function to execute bd search and disp in Telescope","description":"## Context\n\nWith the execute infrastructure now in place (commit 5f0ea69c), the core.execute_with_ui() function already handles routing 'search' commands to Telescope via the TELESCOPE_COMMANDS whitelist. This ticket is likely **obsolete** - we don't need a separate show_search() function.\n\n## Original Plan (Likely Obsolete)\n\n~~Implement core.show_search(query, filters) in lua/nvim-beads/core.lua.~~\n\n~~Key changes:~~\n~~- Build bd_args from query string and filters (status, type)~~\n~~- Call show_issues(bd_args, opts) to display in Telescope~~\n~~- Reuses new execute infrastructure~~\n\n## Revised Approach\n\nFollowing the pattern from list/ready (see nvim-beads-p66), search should work by:\n1. Building bd_args array: `{'search', query}`\n2. Building filter table: `{status = ..., type = ...}`\n3. Calling `execute_with_ui(bd_args, filter)`\n\nSince 'search' is already in the TELESCOPE_COMMANDS whitelist, execute_with_ui will automatically route it to show_issues, which will display results in Telescope.\n\n**Recommendation:** This ticket may not be needed. The init.search() API (nvim-beads-azf) can directly call execute_with_ui without needing an intermediate show_search() function. Consider closing this ticket if that approach works.","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-06T22:13:32.395251516-07:00","updated_at":"2025-12-07T10:19:27.144058642-07:00","closed_at":"2025-12-07T10:19:27.144058642-07:00","dependencies":[{"issue_id":"nvim-beads-kag","depends_on_id":"nvim-beads-bec","type":"blocks","created_at":"2025-12-06T22:48:31.526867061-07:00","created_by":"daemon"}]}
{"id":"nvim-beads-4gh","title":"Implement public Lua API","description":"Expose nvim-beads functionality through a clean public Lua API following standard Neovim plugin patterns. This allows users to invoke operations programmatically and eliminates duplication between Vim commands and internal implementations.","status":"closed","priority":1,"issue_type":"epic","created_at":"2025-12-06T11:49:58.371411483-07:00","updated_at":"2025-12-06T22:42:37.875074516-07:00","closed_at":"2025-12-06T22:42:37.875074516-07:00"}
{"id":"nvim-beads-pkk","title":"Migrate remaining 7 test files to use test_utilities/env.lua","description":"Seven test files still use custom vim mocking instead of env.lua:\n1. plugin_commands_spec.lua (269 lines)\n2. extract_id_spec.lua (233 lines)\n3. util_spec.lua (87 lines)\n4. navigation_spec.lua (381 lines)\n5. create_command_spec.lua (407 lines)\n6. diff_spec.lua (433 lines) - if it still exists after deduplication task\n7. telescope/nvim_beads_spec.lua (406 lines)\n\nThis task completes the env.lua migration across the entire test suite.","notes":"Completed migration analysis and work. Initial analysis missed one file.\n\n**Files that ACTUALLY needed migration (3):**\n- plugin_commands_spec.lua - MIGRATED ✅\n- navigation_spec.lua - MIGRATED ✅\n- telescope/nvim_beads_spec.lua - MIGRATED ✅ (initially missed, has custom telescope mocking but env.lua works fine)\n\n**Files with NO vim mocking (4):**\n- util_spec.lua - Pure function tests, no vim dependency\n- extract_id_spec.lua - Pure JSON parsing tests\n- create_command_spec.lua - Pure function tests\n- diff_spec.lua - Pure function tests\n\nAll three files that needed migration have been successfully migrated to use test_utilities/env.lua. The telescope spec file required keeping its custom vim.system behavior but env.lua handles the setup/teardown. All 397 tests pass. Coverage maintained.","status":"closed","priority":1,"issue_type":"task","created_at":"2025-12-07T18:15:41.074867497-07:00","updated_at":"2025-12-07T19:48:07.820852934-07:00","closed_at":"2025-12-07T19:48:07.820852934-07:00","dependencies":[{"issue_id":"nvim-beads-pkk","depends_on_id":"nvim-beads-42c","type":"blocks","created_at":"2025-12-07T18:16:25.610939449-07:00","created_by":"daemon"}]}
{"id":"nvim-beads-y08","title":"Eliminate execute_with_ui test overlap between commands_spec and init_spec","description":"execute_with_ui is tested in two places:\n- commands_spec.lua: lines 695-948 (unit tests of routing logic)\n- init_spec.lua: tests through public API (integration tests)\n\nAnalysis shows ~100-150 lines of overlapping test coverage.\n\nNeed to audit both suites and eliminate duplication while preserving valuable tests.","status":"open","priority":1,"issue_type":"task","created_at":"2025-12-07T18:15:43.263567847-07:00","updated_at":"2025-12-07T18:15:43.263567847-07:00","dependencies":[{"issue_id":"nvim-beads-y08","depends_on_id":"nvim-beads-as6","type":"blocks","created_at":"2025-12-07T18:16:25.928964323-07:00","created_by":"daemon"},{"issue_id":"nvim-beads-y08","depends_on_id":"nvim-beads-1kq","type":"blocks","created_at":"2025-12-07T18:16:26.266084729-07:00","created_by":"daemon"}]}
{"id":"nvim-beads-tjz","title":"Create argument parser for 'Beads list' filters","description":"This task involves creating a dedicated Lua function to parse and validate the filter arguments passed to the 'Beads list' command.","status":"closed","priority":3,"issue_type":"feature","created_at":"2025-12-01T21:43:56.647872781-07:00","updated_at":"2025-12-02T20:12:07.294369532-07:00","closed_at":"2025-12-02T20:12:07.294369532-07:00"}
{"id":"nvim-beads-a1f","title":"Migrate core_spec.lua to use test_utilities/env.lua","description":"core_spec.lua (1,092 lines) is the second-largest test file with extensive custom vim mocking.\n\nCurrently duplicates mocking setup across 2 before_each blocks with custom:\n- vim.notify tracking\n- vim.system mocking\n- vim.fn mocking\n- Buffer API mocking\n\nMigrating to env.lua will eliminate ~200 lines of mock duplication.","notes":"Investigation complete. This file does NOT need env.lua migration.\n\n**Findings:**\n- No duplicated vim mocking in before_each blocks\n- 31 tests individually mock vim.system with test-specific return values (appropriate)\n- 3 tests individually mock vim.notify for error testing (appropriate)\n- before_each blocks only handle module loading and package.loaded mocking\n\n**Why env.lua isn't needed:**\nThe vim.system mocking is intentionally per-test because each test needs different outputs. This is good test design, not duplication. Converting to env.lua would actually make tests worse by requiring tests to override env.lua's mocks.\n\n**Conclusion:**\ncore_spec.lua is already well-structured. No refactoring needed. The task was based on incorrect assessment of the file.","status":"closed","priority":1,"issue_type":"task","created_at":"2025-12-07T18:15:38.986096466-07:00","updated_at":"2025-12-07T19:37:44.87425216-07:00","closed_at":"2025-12-07T19:37:44.87425216-07:00","dependencies":[{"issue_id":"nvim-beads-a1f","depends_on_id":"nvim-beads-42c","type":"blocks","created_at":"2025-12-07T18:16:24.966002046-07:00","created_by":"daemon"}]}
{"id":"nvim-beads-303","title":"Investigate and resolve diff_spec.lua duplication with commands_spec.lua","description":"There are TWO test files testing nvim-beads.issue.diff.generate_update_commands:\n- spec/nvim-beads/diff_spec.lua (433 lines)\n- spec/nvim-beads/commands_spec.lua lines 1-501\n\nThis is a potential 400-500 line duplication that needs investigation and resolution.\n\nThis is the HIGHEST IMPACT single task in the refactoring plan.","notes":"Investigation complete. These files are NOT duplicates.\n\n**Findings:**\n- diff_spec.lua (433 lines) tests the diff_issues() function\n- commands_spec.lua lines 1-501 test the generate_update_commands() function\n\nBoth functions are in lua/nvim-beads/issue/diff.lua but serve different purposes:\n1. diff_issues() - compares two issue objects and returns structured changes\n2. generate_update_commands() - converts those changes into bd CLI commands\n\nThis is proper test organization - one focused test file per function. The confusion arose because both use describe(\"nvim-beads.issue.diff\") but with different nested describe blocks.\n\n**Conclusion:** No duplication exists. No refactoring needed. The 400-500 line savings estimated in the plan was based on an incorrect assumption.","status":"closed","issue_type":"task","created_at":"2025-12-07T18:15:35.879885435-07:00","updated_at":"2025-12-07T19:26:38.689780417-07:00","closed_at":"2025-12-07T19:26:38.689780417-07:00"}
{"id":"nvim-beads-tk5","title":"Update command handlers to use public API","description":"Refactor lua/nvim-beads/commands.lua so all subcommand implementations become thin wrappers that parse command-line args into opts tables and delegate to the public API.","status":"closed","priority":1,"issue_type":"task","created_at":"2025-12-06T11:50:28.523578957-07:00","updated_at":"2025-12-06T13:10:14.386275285-07:00","closed_at":"2025-12-06T13:10:14.386275285-07:00","dependencies":[{"issue_id":"nvim-beads-tk5","depends_on_id":"nvim-beads-4gh","type":"parent-child","created_at":"2025-12-06T11:50:28.534851886-07:00","created_by":"daemon"},{"issue_id":"nvim-beads-tk5","depends_on_id":"nvim-beads-9sa","type":"blocks","created_at":"2025-12-06T11:50:49.758537819-07:00","created_by":"daemon"},{"issue_id":"nvim-beads-tk5","depends_on_id":"nvim-beads-ctv","type":"blocks","created_at":"2025-12-06T11:50:49.859271568-07:00","created_by":"daemon"}]}
{"id":"nvim-beads-d59","title":"Create type definitions module (types.lua)","description":"Create lua/nvim-beads/types.lua module with type definitions and documentation for issue data structures used throughout the plugin. This will serve as the single source of truth for what fields exist on issue objects.","status":"closed","priority":1,"issue_type":"task","created_at":"2025-11-30T18:24:30.27172829-07:00","updated_at":"2025-11-30T18:36:35.2943781-07:00","closed_at":"2025-11-30T18:36:35.2943781-07:00"}
{"id":"nvim-beads-7zt","title":"Project scaffolding and cleanup","description":"Rename plugin/plugin_template.lua to plugin/nvim-beads.lua, create initial module structure (lua/nvim-beads/core.lua, lua/nvim-beads/commands.lua, lua/telescope/_extensions/nvim_beads/init.lua), remove template-specific example code and tests, and update project documentation.","status":"closed","priority":1,"issue_type":"task","created_at":"2025-11-30T17:08:46.057428882-07:00","updated_at":"2025-11-30T17:40:53.480954819-07:00","closed_at":"2025-11-30T17:40:53.480954819-07:00"}
{"id":"nvim-beads-v3m","title":"Implement Diff Logic with Tests","description":"Implement the comparison/diff logic to detect what changed between the original issue state (from `bd show --json`) and the modified buffer state (from the parser).\n\nThis is a pure function that takes two issue tables and returns a structured list of changes, which will be used to generate the appropriate `bd` commands.","status":"closed","priority":1,"issue_type":"task","created_at":"2025-11-30T20:11:02.589478335-07:00","updated_at":"2025-11-30T20:22:14.699642826-07:00","closed_at":"2025-11-30T20:22:14.699642826-07:00","dependencies":[{"issue_id":"nvim-beads-v3m","depends_on_id":"nvim-beads-m9f","type":"blocks","created_at":"2025-11-30T20:11:02.591709348-07:00","created_by":"daemon"}]}
{"id":"nvim-beads-c8a","title":"Fix buffer reuse when reopening same issue","description":"When opening an issue buffer, then switching to another buffer, then reopening the same issue, we get E95: Buffer with this name already exists. The buffer.lua:67 code creates a new buffer then tries to set the name, but if a hidden buffer with that name exists, nvim_buf_set_name fails. Need to check if buffer exists first and reuse it.","notes":"Fixed by checking if buffer exists with vim.fn.bufnr() before creating new buffer. If buffer exists (bufnr != -1), we reuse it and just refresh the content. Buffer options only set on newly created buffers.","status":"closed","priority":1,"issue_type":"bug","created_at":"2025-12-02T23:00:31.343214383-07:00","updated_at":"2025-12-02T23:02:38.504543037-07:00","closed_at":"2025-12-02T23:02:38.504543037-07:00"}
{"id":"nvim-beads-qje","title":"Unit tests for core bd executor","description":"Create spec file for core.lua with tests that mock vim.system and verify JSON parsing and error handling.","status":"closed","priority":2,"issue_type":"task","created_at":"2025-11-30T17:08:49.751819601-07:00","updated_at":"2025-11-30T18:17:49.012403048-07:00","closed_at":"2025-11-30T18:00:38.898435116-07:00","dependencies":[{"issue_id":"nvim-beads-qje","depends_on_id":"nvim-beads-3ip","type":"blocks","created_at":"2025-11-30T17:09:23.315607188-07:00","created_by":"daemon"}]}
{"id":"nvim-beads-z3p","title":"Configure Telescope picker to use ascending sorting strategy","description":"## Feature Request\n\nConfigure the nvim-beads Telescope picker to use `sorting_strategy = \"ascending\"` so that the most relevant results appear at the bottom of the list, matching Telescope's standard UX idiom.\n\n## Motivation\n\nCurrently, the Telescope extension uses Telescope's default `sorting_strategy = \"descending\"`, which places the first item from bd at the top of the picker. This is backwards from Telescope's typical UX where users expect the most relevant match at the bottom of the list (cursor starts at bottom, move up for less relevant).\n\nTelescope pickers with ascending strategy feel more natural because:\n- Cursor starts at the most relevant item (bottom)\n- Eyes naturally focus on the bottom of the terminal/window\n- Consistent with other Telescope pickers users are familiar with\n\n## Use Cases\n\n1. **Consistency**: User switches from telescope file picker to beads picker, expects same UX\n2. **Ergonomics**: Most relevant item at bottom means less eye/cursor movement\n3. **Familiarity**: Matches muscle memory from other Telescope pickers\n\n## Proposed Solution\n\nSet `sorting_strategy = \"ascending\"` in the picker options passed to `pickers.new()` in telescope extension.","status":"closed","priority":2,"issue_type":"feature","created_at":"2025-12-07T13:46:37.254112325-07:00","updated_at":"2025-12-07T13:59:45.853456635-07:00","closed_at":"2025-12-07T13:59:45.853456635-07:00"}
{"id":"nvim-beads-309","title":"Refactor telescope previewer to use core.get_issue_async()","description":"The telescope issue previewer (lines 32-59) has duplicate async issue fetching and parsing. Refactor to use the new core.get_issue_async() helper.","status":"closed","priority":3,"issue_type":"task","created_at":"2025-12-06T10:56:59.18960488-07:00","updated_at":"2025-12-06T11:13:57.088955556-07:00","closed_at":"2025-12-06T11:13:57.088955556-07:00","dependencies":[{"issue_id":"nvim-beads-309","depends_on_id":"nvim-beads-2gf","type":"blocks","created_at":"2025-12-06T10:56:59.200757204-07:00","created_by":"daemon"}]}
{"id":"nvim-beads-m9f","title":"Implement Content Parser with Tests","description":"Implement the `parse_markdown_to_issue(buffer_content)` function in `lua/nvim-beads/issue.lua` to parse buffer content (YAML frontmatter + Markdown sections) back into a Lua table structure.\n\nThis is the first step in Iteration 4: enabling users to edit and save existing issues from beads:// buffers.","status":"closed","priority":1,"issue_type":"task","created_at":"2025-11-30T20:10:29.000860442-07:00","updated_at":"2025-11-30T20:18:09.243905763-07:00","closed_at":"2025-11-30T20:18:09.243905763-07:00"}
{"id":"nvim-beads-6yd","title":"Implement Telescope hotkey for deleting issues with confirmation","description":"As requested, implement a feature to allow users to delete a selected `beads` issue directly from the Telescope issue list. The deletion process must include a confirmation step to prevent accidental data loss.\n\n**Implementation Details**:\n-   **Telescope Custom Mapping**: Add a normal mode keymap (e.g., 'd') within the `beads` Telescope picker. This mapping will trigger a Lua function.\n-   **Selected Entry Retrieval**: The Lua function will retrieve the currently selected issue entry from the Telescope picker using `require('telescope.actions.state').get_selected_entry()`.\n-   **User Confirmation**: A confirmation dialog will be presented to the user via `vim.fn.confirm()` before proceeding with the issue deletion.\n-   **Asynchronous Deletion**: Upon user confirmation, an asynchronous shell command will be executed using `vim.system()` to delete the issue. The command is assumed to be `bd delete \u003cissue_id\u003e`. (Note: The exact `bd` command for deletion needs to be verified; it might be a `bd close` variant or a dedicated `bd delete` command).\n-   **Picker Refresh**: After a successful deletion, the Telescope picker's list of issues must be refreshed to immediately reflect the change and remove the deleted item from the view. This can be attempted using `require('telescope.actions').repopulate_picker(picker)`. If this specific action is not available or suitable, an alternative refresh mechanism or picker re-initialization will be required.","status":"closed","priority":1,"issue_type":"feature","created_at":"2025-12-02T21:21:12.280070713-07:00","updated_at":"2025-12-02T21:30:50.868883-07:00","closed_at":"2025-12-02T21:30:50.868883-07:00"}
{"id":"nvim-beads-4aq","title":"Refactor verbose command assertion patterns using helpers","description":"Many tests use verbose iteration to validate bd command tables, especially when checking for flags in any order.\n\nPattern appears frequently in diff_spec.lua, commands_spec.lua, core_spec.lua.\n\nExample verbose pattern (15+ lines):\n```lua\nlocal cmd = commands[1]\nassert.equals(\"bd\", cmd[1])\nassert.equals(\"update\", cmd[2])\nlocal has_title = false\nlocal has_priority = false\nfor i = 4, #cmd, 2 do\n    if cmd[i] == \"--title\" and cmd[i + 1] == \"Updated Title\" then\n        has_title = true\n    elseif cmd[i] == \"--priority\" and cmd[i + 1] == \"0\" then\n        has_priority = true\n    end\nend\nassert.is_true(has_title)\nassert.is_true(has_priority)\n```\n\nThis should use assertion helpers created in earlier task.\n\nEstimated savings: 100-200 lines.","status":"open","priority":3,"issue_type":"task","created_at":"2025-12-07T18:15:50.172164808-07:00","updated_at":"2025-12-07T18:15:50.172164808-07:00","dependencies":[{"issue_id":"nvim-beads-4aq","depends_on_id":"nvim-beads-ypo","type":"blocks","created_at":"2025-12-07T18:16:28.750071394-07:00","created_by":"daemon"}]}
{"id":"nvim-beads-jn5","title":"[OPTIONAL] Separate unit tests from integration tests into directories","description":"Some tests are clearly integration tests (navigation_integration_spec, autocmd_integration_spec), others are unit tests, but they're mixed in the same directory structure.\n\nSeparating into spec/unit/ and spec/integration/ would:\n- Make it clear what kind of test you're looking at\n- Enable running fast unit tests separately from slower integration tests\n- Follow common testing conventions\n\nThis is OPTIONAL and LOWEST PRIORITY - pure organization, no line savings.\n\nOnly do this if earlier phases went well and you want better organization.","status":"open","priority":4,"issue_type":"task","created_at":"2025-12-07T18:15:52.515332017-07:00","updated_at":"2025-12-07T18:15:52.515332017-07:00","dependencies":[{"issue_id":"nvim-beads-jn5","depends_on_id":"nvim-beads-3q2","type":"blocks","created_at":"2025-12-07T18:16:30.29231598-07:00","created_by":"daemon"},{"issue_id":"nvim-beads-jn5","depends_on_id":"nvim-beads-9b0","type":"blocks","created_at":"2025-12-07T18:16:30.684029317-07:00","created_by":"daemon"}]}
{"id":"nvim-beads-ekq","title":"Add Telescope action to open issue buffer on \u003cCR\u003e","description":"Enhance the existing Telescope beads_picker in `lua/telescope/_extensions/nvim_beads/init.lua` to handle the default action (Enter key).\n\nWhen a user presses `\u003cCR\u003e` on a selected issue in the Telescope picker:\n1. The picker should close\n2. The selected issue should be opened in a new buffer using `open_issue_buffer()`\n\nThis provides the primary workflow for navigating from the issue list to viewing/editing individual issues.","status":"closed","priority":1,"issue_type":"task","created_at":"2025-11-30T19:04:40.00089807-07:00","updated_at":"2025-11-30T20:01:52.884162726-07:00","closed_at":"2025-11-30T20:01:52.884162726-07:00","dependencies":[{"issue_id":"nvim-beads-ekq","depends_on_id":"nvim-beads-p69","type":"blocks","created_at":"2025-11-30T19:04:47.576511663-07:00","created_by":"daemon"}]}
{"id":"nvim-beads-mbx","title":"Add search subcommand to commands.lua with argument parsing","description":"## Context\n\nWith the execute infrastructure now in place (commit 5f0ea69c), search should follow the exact same pattern as the list and ready subcommands in commands.lua (see nvim-beads-p66).\n\n## Implementation\n\nAdd 'search' entry to subcommands table in lua/nvim-beads/commands.lua following the list/ready pattern:\n\n**Implementation pattern:**\n```lua\nsearch = {\n    impl = function(args)\n        local beads = require(\"nvim-beads\")\n        local constants = require(\"nvim-beads.constants\")\n        \n        -- Parse args into bd_args and filter\n        local bd_args = { \"search\" }\n        local filter = {}\n        local query_parts = {}\n        \n        for _, arg in ipairs(args) do\n            local normalized = constants.PLURAL_MAP[arg:lower()] or arg:lower()\n            \n            if constants.STATUSES[normalized] and not filter.status then\n                filter.status = normalized\n            elseif constants.ISSUE_TYPES[normalized] and not filter.type then\n                filter.type = normalized\n            else\n                -- Not a filter, add to query\n                table.insert(query_parts, arg)\n            end\n        end\n        \n        -- Error if no query provided\n        if #query_parts == 0 then\n            vim.notify(\"Beads search: query required\", vim.log.levels.ERROR)\n            return\n        end\n        \n        -- Add query parts to bd_args\n        for _, part in ipairs(query_parts) do\n            table.insert(bd_args, part)\n        end\n        \n        beads.execute_with_ui(bd_args, filter)\n    end,\n},\n```\n\n**Key technical details:**\n- Uses constants.STATUSES and constants.ISSUE_TYPES for filter recognition\n- Uses constants.PLURAL_MAP to normalize plural forms (e.g., 'bugs' -\u003e 'bug')\n- Builds bd_args as `{'search', 'word1', 'word2', ...}` for multi-word queries\n- Since 'search' is in TELESCOPE_COMMANDS whitelist, execute_with_ui automatically routes to Telescope\n- Client-side filters applied by Telescope extension\n\n**Examples:**\n- `Beads search foo bar` → bd_args={'search', 'foo', 'bar'}, filter={}\n- `Beads search open foo bar` → bd_args={'search', 'foo', 'bar'}, filter={status='open'}\n- `Beads search bugs foo bar` → bd_args={'search', 'foo', 'bar'}, filter={type='bug'}\n- `Beads search open bugs foo` → bd_args={'search', 'foo'}, filter={status='open', type='bug'}\n- `Beads search open` → ERROR (no query)","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-06T22:14:42.631049411-07:00","updated_at":"2025-12-07T10:20:32.667854607-07:00","closed_at":"2025-12-07T10:20:32.667854607-07:00","dependencies":[{"issue_id":"nvim-beads-mbx","depends_on_id":"nvim-beads-kag","type":"blocks","created_at":"2025-12-06T22:49:26.455544314-07:00","created_by":"daemon"}]}
{"id":"nvim-beads-7g8","title":"Refactor Telescope extension to accept and preserve bd_args for refresh","description":"## Background\n\nIn the grand scheme, our goal is to create a new 'Beads execute' master low-level command that, for whitelisted commands like 'list' or 'search', will allow the user to pass command-line arguments directly to 'bd' (exposing the full range of features the tool allows) while still presenting the results in Telescope or other fancy UIs we might build in the future.\n\nOf course, by doing that, we end up duplicating a lot of what things like 'Beads list' do, so we're going to refactor those commands to ultimately use this new infra, since it's a strict functional superset.\n\nThis, then, is the very first step.\n\n## This story\n\nChange telescope/_extensions/nvim_beads/init.lua to work with bd_args in addition to filters.\n\nNotably, we have to support both because we want to pass the arguments directly to 'bd' but we may also apply client-side filters (for example 'ready' doesn't support filtering by issue type, but we want to support that so we apply that filter in the plugin).\n\nKey changes:\n- Rename list() function to show_issues(bd_args, opts)\n- Accept bd_args (e.g., {'list', '--status', 'open'}) in addition to an optional filter table\n- Execute bd command using beads.execute(bd_args)\n- Apply the optional supplied filter table to the resulting list\n- Update all action callbacks (delete, close, open, mark in-progress) to preserve and re-execute with same bd_args and filters on refresh\n- Update exports to use new function name\n\nAcceptance criteria:\n- Telescope picker can be invoked with bd_args array and optional filter table\n- After mutations (close/delete/open issue), picker refreshes using same bd_args and filter table\n- Title defaults to \"Beads Issues\" or can be overridden via opts.title","status":"closed","issue_type":"task","created_at":"2025-12-06T22:47:23.08024192-07:00","updated_at":"2025-12-06T23:37:44.106482393-07:00","closed_at":"2025-12-06T23:37:44.106482393-07:00"}
{"id":"nvim-beads-1kq","title":"Migrate init_spec.lua to use test_utilities/env.lua","description":"init_spec.lua (718 lines) tests the public API and uses custom mocking despite env.lua being available.\n\nHas 2 before_each blocks with custom vim mocking and complex module mocking patterns.\n\nMigration will save ~100 lines and improve consistency.","status":"closed","priority":1,"issue_type":"task","created_at":"2025-12-07T18:15:40.00049511-07:00","updated_at":"2025-12-07T19:41:49.928981621-07:00","closed_at":"2025-12-07T19:41:49.928981621-07:00","dependencies":[{"issue_id":"nvim-beads-1kq","depends_on_id":"nvim-beads-42c","type":"blocks","created_at":"2025-12-07T18:16:25.279718537-07:00","created_by":"daemon"}]}
{"id":"nvim-beads-daa","title":"Implement template fetching and :BeadsCreateIssue command","description":"Implement the core `:BeadsCreateIssue \u003ctype\u003e` command that will be the entry point for creating new issues. This command needs to validate the issue type argument and initiate the template fetching workflow.\n\nThe command should accept one of the valid issue types: bug, feature, task, epic, or chore.\n\nThis is part of Iteration 5: Create New Issues from the implementation plan.","status":"closed","priority":1,"issue_type":"task","created_at":"2025-11-30T21:05:41.35042767-07:00","updated_at":"2025-11-30T21:14:53.915739947-07:00","closed_at":"2025-11-30T21:14:53.915739947-07:00"}
{"id":"nvim-beads-2gf","title":"Add core.get_issue_async() helper function","description":"Create an async version of core.get_issue() for use in the telescope previewer. This consolidates the async issue fetching, parsing, and validation logic.","status":"closed","priority":3,"issue_type":"task","created_at":"2025-12-06T10:56:53.570008323-07:00","updated_at":"2025-12-06T11:07:08.929899725-07:00","closed_at":"2025-12-06T11:07:08.929899725-07:00","dependencies":[{"issue_id":"nvim-beads-2gf","depends_on_id":"nvim-beads-fix","type":"blocks","created_at":"2025-12-06T10:56:53.571881815-07:00","created_by":"daemon"}]}
{"id":"nvim-beads-5wv","title":"Audit and remove low-value tests (CAREFUL!)","description":"Some tests check implementation details rather than behavior, or provide duplicate coverage with no additional value.\n\nThis is the HIGHEST RISK task in the refactoring plan - removing tests can reduce coverage or eliminate valuable regression detection.\n\nApproach conservatively: when in doubt, keep the test.\n\nEstimated savings: 200-300 lines (but only if done carefully).","status":"open","priority":4,"issue_type":"task","created_at":"2025-12-07T18:15:51.282603637-07:00","updated_at":"2025-12-07T18:15:51.282603637-07:00","dependencies":[{"issue_id":"nvim-beads-5wv","depends_on_id":"nvim-beads-4aq","type":"blocks","created_at":"2025-12-07T18:16:29.508404565-07:00","created_by":"daemon"},{"issue_id":"nvim-beads-5wv","depends_on_id":"nvim-beads-5fu","type":"blocks","created_at":"2025-12-07T18:16:29.897080061-07:00","created_by":"daemon"}]}
{"id":"nvim-beads-7nn","title":"Add validation for 'Beads list' filter arguments","description":"This task adds robust error handling to the filter parsing logic to ensure users are notified of invalid input.","status":"closed","priority":3,"issue_type":"feature","created_at":"2025-12-01T21:44:02.261676571-07:00","updated_at":"2025-12-02T21:03:35.177106609-07:00","closed_at":"2025-12-02T21:03:35.177106609-07:00"}
{"id":"nvim-beads-ctv","title":"Refactor core.lua to accept opts tables instead of fargs arrays","description":"Update show_list() and show_ready() to accept structured opts tables with named parameters (status, type, priority, assignee) instead of raw command-line argument arrays.","status":"closed","priority":1,"issue_type":"task","created_at":"2025-12-06T11:50:28.366816282-07:00","updated_at":"2025-12-06T12:00:24.03960732-07:00","closed_at":"2025-12-06T12:00:24.03960732-07:00","dependencies":[{"issue_id":"nvim-beads-ctv","depends_on_id":"nvim-beads-4gh","type":"parent-child","created_at":"2025-12-06T11:50:28.378466182-07:00","created_by":"daemon"}]}
{"id":"nvim-beads-2s7","title":"Update 'Beads list' command to accept arguments","description":"This task updates the 'Beads list' command definition to accept a variable number of arguments, which will be used for filtering.","status":"closed","priority":3,"issue_type":"feature","created_at":"2025-12-01T21:43:47.317274947-07:00","updated_at":"2025-12-02T17:55:14.585553314-07:00","closed_at":"2025-12-02T17:55:14.585553314-07:00"}
{"id":"nvim-beads-k8m","title":"Implement basic Telescope picker","description":"Create a Telescope picker in lua/telescope/_extensions/nvim_beads/init.lua that displays a list of issues from 'bd list --json' with ID and title.","status":"closed","priority":1,"issue_type":"task","created_at":"2025-11-30T17:08:47.884580337-07:00","updated_at":"2025-11-30T18:12:22.610953439-07:00","closed_at":"2025-11-30T18:12:22.610953439-07:00","dependencies":[{"issue_id":"nvim-beads-k8m","depends_on_id":"nvim-beads-7zt","type":"blocks","created_at":"2025-11-30T17:09:20.495242365-07:00","created_by":"daemon"},{"issue_id":"nvim-beads-k8m","depends_on_id":"nvim-beads-3ip","type":"blocks","created_at":"2025-11-30T17:09:21.452023184-07:00","created_by":"daemon"}]}
{"id":"nvim-beads-4p0","title":"Replace duplicate line splitting in telescope with util.split_lines_with_newlines()","description":"The telescope integration (lua/telescope/_extensions/nvim_beads/init.lua:64-83) has duplicate line splitting logic that's identical to util.split_lines_with_newlines(). Replace the ~20 lines of duplicate code with a single function call.","status":"closed","priority":1,"issue_type":"task","created_at":"2025-12-06T10:56:25.917756068-07:00","updated_at":"2025-12-06T11:00:45.136271274-07:00","closed_at":"2025-12-06T11:00:45.136271274-07:00"}
{"id":"nvim-beads-9a6","title":"Refactor telescope action handlers to use core.execute_bd_async()","description":"The telescope action handlers (delete_issue, close_issue, open_issue, mark_as_in_progress) all have duplicate async bd command execution and JSON parsing. Refactor to use the new core.execute_bd_async() helper.","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-06T10:56:47.026166188-07:00","updated_at":"2025-12-06T11:06:04.397827795-07:00","closed_at":"2025-12-06T11:06:04.397827795-07:00","dependencies":[{"issue_id":"nvim-beads-9a6","depends_on_id":"nvim-beads-fix","type":"blocks","created_at":"2025-12-06T10:56:47.037757247-07:00","created_by":"daemon"}]}
{"id":"nvim-beads-766","title":"Document public Lua API in help docs","description":"Add comprehensive documentation for the public Lua API to the help docs, including function signatures, parameter descriptions, and usage examples.","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-06T11:50:29.035714314-07:00","updated_at":"2025-12-06T13:37:21.707254356-07:00","closed_at":"2025-12-06T13:37:21.707254356-07:00","dependencies":[{"issue_id":"nvim-beads-766","depends_on_id":"nvim-beads-4gh","type":"parent-child","created_at":"2025-12-06T11:50:29.046824511-07:00","created_by":"daemon"},{"issue_id":"nvim-beads-766","depends_on_id":"nvim-beads-tk5","type":"blocks","created_at":"2025-12-06T11:50:50.205682912-07:00","created_by":"daemon"},{"issue_id":"nvim-beads-766","depends_on_id":"nvim-beads-on7","type":"blocks","created_at":"2025-12-06T11:50:50.324132565-07:00","created_by":"daemon"},{"issue_id":"nvim-beads-766","depends_on_id":"nvim-beads-1wq","type":"blocks","created_at":"2025-12-06T11:50:50.469848914-07:00","created_by":"daemon"}]}
{"id":"nvim-beads-4pc","title":"Consolidate filter extraction test patterns across search/list/ready commands","description":"Search, list, and ready commands all test filter extraction (status, type, etc.) with nearly identical patterns.\n\nRepetitive test code:\n- Search command: tests status/type filter extraction\n- List command: tests status/type filter extraction  \n- Ready command: tests type filter extraction\n\nOpportunity to create shared test helpers and reduce 50-100 lines.","status":"open","priority":2,"issue_type":"task","created_at":"2025-12-07T18:15:44.415539541-07:00","updated_at":"2025-12-07T18:15:44.415539541-07:00","dependencies":[{"issue_id":"nvim-beads-4pc","depends_on_id":"nvim-beads-as6","type":"blocks","created_at":"2025-12-07T18:16:26.60051185-07:00","created_by":"daemon"}]}
{"id":"nvim-beads-2ry","title":"Extend issue formatter to support full buffer format with YAML frontmatter","description":"The current `format_issue_to_markdown()` function in `lua/nvim-beads/issue.lua` was designed for Telescope preview and may not include all fields required for the editable buffer format.\n\nThis task extends the formatter to output the complete buffer format as specified in detailed-requirements.md section 3.2, including:\n- YAML frontmatter with all metadata fields (id, title, type, status, priority, parent, dependencies, labels, timestamps)\n- Markdown sections (Description, Acceptance Criteria, Design, Notes)\n\nThe formatter should produce output that matches the exact format shown in the requirements, with proper YAML delimiters and section headers.","status":"closed","priority":1,"issue_type":"task","created_at":"2025-11-30T19:03:57.176916401-07:00","updated_at":"2025-11-30T19:10:17.156908602-07:00","closed_at":"2025-11-30T19:10:17.156908602-07:00"}
{"id":"nvim-beads-9b0","title":"Evaluate and potentially split core_spec.lua by functional areas","description":"core_spec.lua is 1,092 lines after migration to env.lua will be ~700-800 lines.\n\nThis task evaluates whether it should be split into multiple files based on what the core module does.\n\nAnalysis needed to determine if split is valuable.","status":"open","priority":3,"issue_type":"task","created_at":"2025-12-07T18:15:46.786389607-07:00","updated_at":"2025-12-07T18:15:46.786389607-07:00","dependencies":[{"issue_id":"nvim-beads-9b0","depends_on_id":"nvim-beads-a1f","type":"blocks","created_at":"2025-12-07T18:16:27.647534623-07:00","created_by":"daemon"}]}
{"id":"nvim-beads-oo2","title":"Add integration tests for execute infrastructure","description":"## Context\n\nWith the execute infrastructure now implemented (commit 5f0ea69c), we need comprehensive integration tests to verify the routing logic and end-to-end behavior.\n\n## Implementation\n\nWrite integration tests for the execute infrastructure implemented in commit 5f0ea69c. Reference spec/nvim-beads/execute_spec.lua for existing test structure.\n\n**Test coverage:**\n\n1. **Telescope routing:**\n   - Verify commands in TELESCOPE_COMMANDS whitelist ('list', 'search', 'blocked', 'ready') route to show_issues\n   - Mock telescope extension and verify show_issues called with correct bd_args\n   - Verify filter table passed correctly to Telescope\n\n2. **Terminal routing:**\n   - Verify commands NOT in whitelist (e.g., 'show', 'create', 'update') route to terminal buffer\n   - Mock util.execute_command_in_scratch_buffer and verify called correctly\n   - Verify command name and args split properly (first arg is command, rest are args)\n\n3. **bd_args preservation:**\n   - Verify Telescope refresh preserves bd_args after mutations (close/delete/open/in_progress)\n   - Mock issue state change and verify picker refreshes with same bd_args and filters\n\n4. **Argument building:**\n   - Verify syntactic sugar commands (list, ready) build correct bd_args\n   - Test: `'list open bugs'` builds bd_args={'list'}, filter={status='open', type='bug'}\n   - Test: `'ready features'` builds bd_args={'ready'}, filter={type='feature'}\n\n5. **Error handling:**\n   - Missing command: `execute_with_ui({})` shows error\n   - bd command failures: exit code ≠ 0 handled gracefully\n   - Invalid JSON from bd command\n\n**Acceptance criteria:**\n- All routing paths tested (Telescope vs terminal)\n- Mock bd execution and verify correct args passed\n- Verify TELESCOPE_COMMANDS whitelist logic\n- Verify bd_args preservation across refresh operations\n- Error cases handled properly","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-06T22:47:25.716007661-07:00","updated_at":"2025-12-07T11:40:42.174080894-07:00","closed_at":"2025-12-07T11:40:42.174080894-07:00","dependencies":[{"issue_id":"nvim-beads-oo2","depends_on_id":"nvim-beads-p66","type":"blocks","created_at":"2025-12-06T22:48:32.506302479-07:00","created_by":"daemon"}]}
{"id":"nvim-beads-73s","title":"Add support for showing stale tickets","description":"Currently, the `:Beads list` command supports filtering by several states, including the pseudo-state 'ready'. This feature will introduce a new pseudo-state, 'stale', to allow users to easily view issues that have not been updated recently.","status":"closed","priority":2,"issue_type":"feature","created_at":"2025-12-02T22:09:58.187729118-07:00","updated_at":"2025-12-02T22:16:17.803108119-07:00","closed_at":"2025-12-02T22:16:17.803108119-07:00"}
{"id":"nvim-beads-9sa","title":"Create lua/nvim-beads/init.lua with public API","description":"Create the main public API module that exposes list(), show(), create(), ready(), and execute() functions. This becomes the canonical interface for nvim-beads.","status":"closed","priority":1,"issue_type":"task","created_at":"2025-12-06T11:50:28.219047407-07:00","updated_at":"2025-12-06T13:07:48.298540688-07:00","closed_at":"2025-12-06T13:07:48.298540688-07:00","dependencies":[{"issue_id":"nvim-beads-9sa","depends_on_id":"nvim-beads-4gh","type":"parent-child","created_at":"2025-12-06T11:50:28.230262481-07:00","created_by":"daemon"}]}
{"id":"nvim-beads-48r","title":"Implement Save Autocommand Integration","description":"Wire together all the pieces to implement the save workflow for beads:// buffers. When a user saves an issue buffer, the autocommand should parse the buffer, detect changes, execute the appropriate `bd` commands, and reload the buffer with the authoritative state.\nThis is the orchestration layer that connects the parser, diff logic, and command generation into a working feature.\n\nAdding some more text in the description here.","notes":"## Implementation Complete\nCreated `lua/nvim-beads/autocmds.lua` with the following implementation:\n\n### Key Features\n1. **BufWriteCmd autocommand** for `beads://issue/*` pattern\n2. **Complete save workflow**:\n   - Parses buffer content using `parse_markdown_to_issue()`\n   - Fetches original state via `bd show --json`\n   - Diffs states using `diff_issues()`\n   - Generates update commands using `generate_update_commands()`\n   - Executes commands sequentially via shell\n   - Reloads buffer on success with updated content\n3. **Error handling** at every step (parse, fetch, command execution)\n4. **Cursor position preservation** after reload\n5. **Modified flag management** (cleared after successful save)\n6. **Special handling for parent removal** (needs original parent ID lookup)\n\n### Integration\n- Wired into `plugin/nvim-beads.lua` via `require(\"nvim-beads.autocmds\").setup()`\n- Uses `BufWriteCmd` (correct for `acwrite` buffers)\n\n### Testing\n- All existing unit tests pass (125 tests)\n- Manual test guide created in `MANUAL_TEST.md`\n- Ready for manual integration testing\n\n### Files Modified\n1. `lua/nvim-beads/autocmds.lua` (new file)\n2. `plugin/nvim-beads.lua` (added setup() call)\n3. `MANUAL_TEST.md` (testing guide)\nThe implementation follows the design document exactly and integrates all the previously implemented pieces (parser, diff, command generation) into a working save workflow.","status":"closed","priority":1,"issue_type":"task","created_at":"2025-11-30T20:11:24.735604837-07:00","updated_at":"2025-11-30T21:01:05.825062479-07:00","closed_at":"2025-11-30T21:01:05.825062479-07:00","dependencies":[{"issue_id":"nvim-beads-48r","depends_on_id":"nvim-beads-4y7","type":"blocks","created_at":"2025-11-30T20:11:28.503817756-07:00","created_by":"daemon"}]}
{"id":"nvim-beads-n85","title":"Implement Telescope hotkey to close issues","description":"Create a feature to allow users to mark a selected `beads` issue as \"closed\" directly from the Telescope issue list.\n\n**Implementation Details**:\n-   **Telescope Custom Mapping**: Add a normal mode keymap ('c') within the `beads` Telescope picker.\n-   **Selected Entry Retrieval**: The Lua function will retrieve the currently selected issue entry from the Telescope picker using `require('telescope.actions.state').get_selected_entry()`.\n-   **User Confirmation**: A confirmation dialog via `vim.fn.confirm()` must be shown before changing the status.\n-   **Asynchronous Update**: Upon confirmation, execute `bd update \u003cissue_id\u003e --status closed --json` using `vim.system()`.\n-   **Picker Refresh**: After a successful update, the Telescope picker list must be refreshed to reflect the status change.","status":"closed","priority":1,"issue_type":"feature","created_at":"2025-12-02T21:24:53.877702726-07:00","updated_at":"2025-12-02T21:40:46.155533924-07:00","closed_at":"2025-12-02T21:40:46.155533924-07:00"}
{"id":"nvim-beads-w09","title":"Implement new issue buffer manager (open_new_issue_buffer)","description":"Implement the `open_new_issue_buffer(issue_type, template_data)` function that creates and populates a new buffer for issue creation. The buffer should be pre-filled with the template data in the standard Markdown format with YAML frontmatter.\n\nThis buffer will use the special URI scheme `beads://issue/new?type=\u003ctype\u003e` to distinguish it from existing issue buffers.\n\nThis is part of Iteration 5: Create New Issues from the implementation plan.","status":"closed","priority":1,"issue_type":"task","created_at":"2025-11-30T21:06:12.459379269-07:00","updated_at":"2025-11-30T21:20:56.515150727-07:00","closed_at":"2025-11-30T21:20:56.515150727-07:00","dependencies":[{"issue_id":"nvim-beads-w09","depends_on_id":"nvim-beads-daa","type":"blocks","created_at":"2025-11-30T21:06:12.462084861-07:00","created_by":"daemon"}]}
{"id":"nvim-beads-24h","title":"Extend save autocommand to handle new issue creation","description":"Modify the existing `BufWritePost` autocommand to detect and handle the creation workflow for new issue buffers (buffers with name matching `beads://issue/new*`).\n\nThis includes executing the create command, capturing the new issue ID, renaming the buffer, and reloading the content from the authoritative source.\n\nThis is part of Iteration 5: Create New Issues from the implementation plan.","status":"closed","priority":1,"issue_type":"task","created_at":"2025-11-30T21:06:13.019365381-07:00","updated_at":"2025-11-30T21:46:47.663989468-07:00","closed_at":"2025-11-30T21:46:47.663989468-07:00","dependencies":[{"issue_id":"nvim-beads-24h","depends_on_id":"nvim-beads-daa","type":"blocks","created_at":"2025-11-30T21:06:13.021430239-07:00","created_by":"daemon"},{"issue_id":"nvim-beads-24h","depends_on_id":"nvim-beads-a9s","type":"blocks","created_at":"2025-11-30T21:06:13.023731038-07:00","created_by":"daemon"},{"issue_id":"nvim-beads-24h","depends_on_id":"nvim-beads-w09","type":"blocks","created_at":"2025-11-30T21:06:21.187695911-07:00","created_by":"daemon"}]}
{"id":"nvim-beads-3tc","title":"Harden shell command construction to prevent injection vulnerabilities","description":"### Observation\n\nSeveral parts of the codebase construct shell commands by concatenating strings. This is visible in:\n- `issue.lua` (`generate_update_commands`)\n- `autocmds.lua` (`handle_new_issue_save`, `handle_existing_issue_save`)\n\nWhile a `shell_escape` function exists, this approach is inherently less safe than passing arguments as a table to `vim.system`, as it can be vulnerable to shell injection if the escaping is imperfect. The `core.execute_bd` function already uses the safer, table-based approach.\n\n### Recommendation\n\nRefactor all shell command execution to use the table-based `vim.system` calling convention, which avoids manual shell escaping.\n\n1.  Modify `issue.generate_update_commands` to return a list of tables, where each inner table is a sequence of arguments for a single command (e.g., `{{'bd', 'update', issue.id, '--title', 'new title'}, ...}`).\n2.  Update the loop in `autocmds.handle_existing_issue_save` to iterate over this new structure and call `vim.system(cmd_table)` for each command.\n3.  Refactor the command construction in `autocmds.handle_new_issue_save` to build a command table instead of a command string.\n\n### Verification\n\n1.  All existing unit tests must pass. The tests for `issue.generate_update_commands` will need to be updated to assert against the new data structure.\n2.  Perform manual testing with issue fields (like titles or descriptions) that contain special shell characters, such as `'\"`, `'`, `!`, `\u0026`, `|`, `;`, `$`, `(`, and `)`.\n3.  Confirm that creating and updating issues with such characters succeeds without errors and that the characters are preserved correctly in the underlying issue data. For example, a title like `\"Fix critical bug in tokenizer's loop \u0026\u0026 parser\"` should not fail the save process.","status":"closed","priority":3,"issue_type":"task","created_at":"2025-12-01T20:52:11.274765435-07:00","updated_at":"2025-12-02T20:02:37.524148662-07:00","closed_at":"2025-12-02T20:02:37.524158649-07:00"}
{"id":"nvim-beads-mev","title":"Core plugin cleanup","description":"The code within the plugin is generally pretty solid, but we can refactor it and clean it up a bit. This task captures those little cleanup jobs.","status":"closed","issue_type":"task","created_at":"2025-12-01T22:26:57.506739741-07:00","updated_at":"2025-12-02T21:45:57.342277112-07:00","closed_at":"2025-12-02T21:45:57.342283158-07:00","dependencies":[{"issue_id":"nvim-beads-mev","depends_on_id":"nvim-beads-3tc","type":"blocks","created_at":"2025-12-01T22:26:57.508912332-07:00","created_by":"daemon"},{"issue_id":"nvim-beads-mev","depends_on_id":"nvim-beads-ctb","type":"blocks","created_at":"2025-12-01T22:26:57.511339836-07:00","created_by":"daemon"},{"issue_id":"nvim-beads-mev","depends_on_id":"nvim-beads-2s3","type":"blocks","created_at":"2025-12-01T22:26:57.513411299-07:00","created_by":"daemon"},{"issue_id":"nvim-beads-mev","depends_on_id":"nvim-beads-5do","type":"blocks","created_at":"2025-12-01T22:26:57.515520984-07:00","created_by":"daemon"}]}
{"id":"nvim-beads-q2g","title":"Apply state and type filters in Telescope finder","description":"This task implements the core filtering logic within the Telescope extension, applying the parsed filters to the list of issues.","status":"closed","priority":3,"issue_type":"feature","created_at":"2025-12-01T21:44:07.593632206-07:00","updated_at":"2025-12-02T21:03:38.496682634-07:00","closed_at":"2025-12-02T21:03:38.496682634-07:00"}
{"id":"nvim-beads-zzt","title":"Implement Telescope buffer previewer","description":"Add a buffer previewer to the Telescope beads_picker that shows formatted issue content when hovering over issues in the list. Uses bd show --json to fetch full issue data and format_issue_to_markdown to display it.","status":"closed","priority":1,"issue_type":"task","created_at":"2025-11-30T18:24:31.0020946-07:00","updated_at":"2025-11-30T18:54:39.76604869-07:00","closed_at":"2025-11-30T18:54:39.76604869-07:00","dependencies":[{"issue_id":"nvim-beads-zzt","depends_on_id":"nvim-beads-esz","type":"blocks","created_at":"2025-11-30T18:24:46.29518575-07:00","created_by":"daemon"}]}
{"id":"nvim-beads-qe5","title":"Add 'Beads execute' subcommand and public API","description":"Add new execute subcommand to lua/nvim-beads/commands.lua and public API to init.lua.\n\nCommands subcommand:\n- Accept arbitrary bd command args: :Beads execute \u003ccommand\u003e [args...]\n- Show helpful error if no command provided\n- Delegate to beads.execute_with_ui(args)\n\nPublic API (init.lua):\n- Add M.execute_with_ui(args) that validates and calls core.execute_with_ui()\n- Keep existing M.execute() unchanged (for programmatic use)\n\nAcceptance criteria:\n- :Beads execute list --priority 1 displays in Telescope\n- :Beads execute show bd-123 opens terminal buffer\n- Error shown if command missing","status":"closed","issue_type":"task","created_at":"2025-12-06T22:47:24.366035184-07:00","updated_at":"2025-12-06T23:47:50.295561086-07:00","closed_at":"2025-12-06T23:47:50.295561086-07:00","dependencies":[{"issue_id":"nvim-beads-qe5","depends_on_id":"nvim-beads-bec","type":"blocks","created_at":"2025-12-06T22:48:29.68365873-07:00","created_by":"daemon"}]}
{"id":"nvim-beads-nhb","title":"Add public API function show_under_cursor() for navigating to issue IDs","description":"## Feature Request\n\nExpose a public API function `show_under_cursor()` in `init.lua` that:\n1. Detects an issue ID under the cursor in ANY buffer (not just beads:// buffers)\n2. Opens that issue via the existing `show()` function\n3. Shares core detection logic with the buffer-local Enter mapping from nvim-beads-5ia\n\n## Motivation\n\nThe Enter key mapping in beads buffers (nvim-beads-5ia) is useful, but users may want to:\n- Navigate to issue IDs in regular markdown files (e.g., project notes, PR descriptions)\n- Jump to issues mentioned in code comments\n- Create their own custom keybindings in different contexts\n- Use the functionality in other buffers where we don't control the filetype/settings\n\nExposing this as a public API allows maximum flexibility while maintaining the same reliable ID detection logic.\n\n## Use Cases\n\n1. **Project documentation**: User has a README.md mentioning \"fixes nvim-beads-42\" - custom keymap lets them jump to that issue\n2. **Code comments**: Lua file has `-- TODO: see nvim-beads-123 for design` - jump directly from code to issue\n3. **Custom workflows**: User prefers `gf` instead of `\u003cCR\u003e` - they can map it to `show_under_cursor()`\n4. **Plugin integration**: Other plugins can call this function to integrate beads navigation\n\n## Proposed Solution\n\nPublic API in `init.lua` with optional `notify_on_miss` parameter, returns boolean success.\n\nFunction signature: `show_under_cursor(opts)` where opts table contains optional notify_on_miss boolean (defaults true). Prefix is always auto-detected.\n\n## Alternatives Considered\n\n- **Alternative 1**: Only work in beads buffers - rejected, too limiting\n- **Alternative 2**: Require explicit prefix parameter - rejected, auto-detection works for single-repo workflows","status":"closed","priority":2,"issue_type":"feature","created_at":"2025-12-07T13:22:47.092087998-07:00","updated_at":"2025-12-07T15:11:40.147106712-07:00","closed_at":"2025-12-07T15:11:40.147106712-07:00","dependencies":[{"issue_id":"nvim-beads-nhb","depends_on_id":"nvim-beads-5ia","type":"blocks","created_at":"2025-12-07T13:22:47.095958329-07:00","created_by":"daemon"}]}
{"id":"nvim-beads-rwx","title":"Refactor unit test suite","description":"The unit test suite has got its flaws, so our goal is to refactor it to reduce duplication, eliminate redundant or low-value tests, and in general make the suite more maintainable.","status":"closed","priority":1,"issue_type":"task","created_at":"2025-12-01T22:24:26.146044232-07:00","updated_at":"2025-12-02T20:47:15.743794794-07:00","closed_at":"2025-12-02T20:47:15.743813117-07:00","dependencies":[{"issue_id":"nvim-beads-rwx","depends_on_id":"nvim-beads-n1c","type":"blocks","created_at":"2025-12-01T22:24:26.149432371-07:00","created_by":"daemon"},{"issue_id":"nvim-beads-rwx","depends_on_id":"nvim-beads-loc","type":"blocks","created_at":"2025-12-01T22:24:26.150773245-07:00","created_by":"daemon"}]}
{"id":"nvim-beads-5do","title":"Refactor large issue.lua module into smaller, single-responsibility modules","description":"### Observation\n\nThe `issue.lua` module currently handles a wide range of responsibilities, including:\n- Data parsing (`parse_markdown_to_issue`)\n- Data formatting (`format_issue_to_markdown`)\n- Data comparison (`diff_issues`)\n- Command generation (`generate_update_commands`)\n- Neovim buffer management and UI (`open_issue_buffer`, `open_new_issue_buffer`)\n\nThis makes the module large and violates the Single Responsibility Principle, making it harder to test and maintain.\n\n### Recommendation\n\nRefactor `issue.lua` by splitting its functionality into smaller, more focused modules under a new `lua/nvim-beads/issue/` directory.\n\n1.  Create a new directory: `lua/nvim-beads/issue/`.\n2.  Consider moving the contents of `issue.lua` to a new `lua/nvim-beads/issue/init.lua` to act as a facade, or refactor all calls to point to the new modules directly.\n3.  Create the following new modules:\n    -   `lua/nvim-beads/issue/parser.lua`: For `parse_markdown_to_issue`.\n    -   `lua/nvim-beads/issue/formatter.lua`: For `format_issue_to_markdown`.\n    -   `lua/nvim-beads/issue/diff.lua`: For `diff_issues` and `generate_update_commands`.\n4.  Move buffer-related functions to a separate module, as they are a UI concern:\n    -   Create `lua/nvim-beads/buffer.lua` for `open_issue_buffer` and `open_new_issue_buffer`.\n5.  Update all `require` statements throughout the codebase (`autocmds.lua`, `commands.lua`, etc.) to point to the new module paths.\n\n### Verification\n\n1.  All existing unit tests in the `spec/` directory must pass after the refactoring. Tests related to the old `issue.lua` module will need to be updated to reflect the new file structure.\n2.  Perform manual end-to-end testing of the core user workflows:\n    -   Creating a new issue (`:Beads create task`).\n    -   Saving the new issue buffer to trigger creation via `bd`.\n    -   Opening an existing issue (`:Beads open \u003cid\u003e`).\n    -   Modifying and saving an existing issue to trigger an update.\n    -   Listing issues via Telescope (`:Beads list`).","status":"closed","priority":3,"issue_type":"task","created_at":"2025-12-01T20:51:58.862730092-07:00","updated_at":"2025-12-02T18:10:15.198388238-07:00","closed_at":"2025-12-02T18:10:15.198388238-07:00"}
{"id":"nvim-beads-63o","title":"Integration test for preview functionality","description":"Verify that the preview functionality works correctly end-to-end in a real Neovim session with actual bd data. Can be manual testing initially, automated later if needed.","status":"closed","priority":2,"issue_type":"task","created_at":"2025-11-30T18:24:31.507794441-07:00","updated_at":"2025-11-30T18:58:00.514968507-07:00","closed_at":"2025-11-30T18:58:00.514968507-07:00","dependencies":[{"issue_id":"nvim-beads-63o","depends_on_id":"nvim-beads-zzt","type":"blocks","created_at":"2025-11-30T18:24:46.445300254-07:00","created_by":"daemon"}]}
{"id":"nvim-beads-as6","title":"Migrate commands_spec.lua to use test_utilities/env.lua","description":"commands_spec.lua (1,090 lines) is the largest test file and duplicates significant vim mocking setup.\n\nCurrently uses custom mocks for:\n- vim.notify (9 instances)\n- vim.log.levels\n- vim.list_slice\n- Various package.loaded manipulations\n\nMigrating to env.lua will eliminate ~200 lines and make it consistent with other tests.\n\nNote: This file will be split in a later task, but migration happens first.","status":"closed","priority":1,"issue_type":"task","created_at":"2025-12-07T18:15:37.932711593-07:00","updated_at":"2025-12-07T19:35:36.99871348-07:00","closed_at":"2025-12-07T19:35:36.99871348-07:00","dependencies":[{"issue_id":"nvim-beads-as6","depends_on_id":"nvim-beads-42c","type":"blocks","created_at":"2025-12-07T18:16:24.647546337-07:00","created_by":"daemon"}]}
{"id":"nvim-beads-42c","title":"Enhance test_utilities/env.lua with additional helpers and documentation","description":"The test_utilities/env.lua module provides comprehensive vim mocking but needs enhancements before we can migrate all tests to use it.\n\nCurrent state: Only 4 of 14 test files use env.lua. The other 10 duplicate vim mocking setup.\n\nThis task enhances env.lua to handle common patterns found across test files, making migration easier.","status":"closed","priority":1,"issue_type":"task","created_at":"2025-12-07T18:15:34.927712091-07:00","updated_at":"2025-12-07T19:28:07.273796736-07:00","closed_at":"2025-12-07T19:28:07.273796736-07:00"}
{"id":"nvim-beads-n1c","title":"Adopt Data-Driven Patterns","description":"**Observation:**\nTest files like `commands_spec.lua`, `create_command_spec.lua`, and `diff_spec.lua` contain many repetitive `it` blocks testing minor variations of the same function. This is verbose and hard to maintain. For example, `commands_spec.lua` has separate tests for title, priority, and assignee changes which all test similar logic.\n\n**Recommendation:**\nRefactor these tests to be data-driven. Define a table of test cases (containing a name, input, and expected output) and iterate over it within a single `describe` block. This will make the tests more concise, easier to read, and simpler to extend with new cases.\n\n**Validation Steps:**\n1. Select `spec/nvim-beads/commands_spec.lua` as the first candidate for refactoring.\n2. Refactor a `describe` block (e.g., 'metadata field updates') to use a table of test cases and a loop.\n3. Ensure all original test logic is covered and that all tests pass after the change.\n4. Apply the same data-driven pattern to other sections of the file and to other suitable spec files.","status":"closed","priority":3,"issue_type":"task","created_at":"2025-12-01T21:03:50.415626667-07:00","updated_at":"2025-12-02T20:45:20.316517898-07:00","closed_at":"2025-12-02T20:45:20.316517898-07:00"}
{"id":"nvim-beads-suj","title":"Add tests for search command argument parsing","description":"## Context\n\nWith the execute infrastructure in place (commit 5f0ea69c), the search command argument parsing in commands.lua should follow the exact same pattern as list and ready commands (see nvim-beads-p66). \n\n## Implementation\n\nWrite tests for the search command's argument parsing logic following the list/ready test pattern in spec/nvim-beads/commands_spec.lua:\n\n**Test areas:**\n\n1. **Query-only (no filters):**\n   - `'search foo bar'` → bd_args={'search', 'foo', 'bar'}, filter={}\n   - `'search single'` → bd_args={'search', 'single'}, filter={}\n\n2. **Status filter:**\n   - `'search open foo'` → bd_args={'search', 'foo'}, filter={status='open'}\n   - `'search foo open bar'` → bd_args={'search', 'foo', 'bar'}, filter={status='open'}\n   - `'search closed foo'` → bd_args={'search', 'foo'}, filter={status='closed'}\n\n3. **Type filter:**\n   - `'search bugs foo'` → bd_args={'search', 'foo'}, filter={type='bug'}\n   - `'search foo features'` → bd_args={'search', 'foo'}, filter={type='feature'}\n   - Plural forms: `'search tasks foo'` → bd_args={'search', 'foo'}, filter={type='task'}\n\n4. **Combined filters:**\n   - `'search open bugs foo'` → bd_args={'search', 'foo'}, filter={status='open', type='bug'}\n   - Filter order doesn't matter: `'search bugs open foo'` → same result\n   - `'search in_progress features bar'` → bd_args={'search', 'bar'}, filter={status='in_progress', type='feature'}\n\n5. **Error cases:**\n   - Missing query: `'search open'` → ERROR (no query after filters extracted)\n   - Missing query: `'search bugs'` → ERROR\n   - Invalid filter: `'search invalid foo'` → bd_args={'search', 'invalid', 'foo'} (treated as query, not filter)\n   - Duplicate filters: `'search open closed foo'` → ERROR (duplicate status filter)\n\n**Test structure:**\n```lua\ndescribe(\"Beads search command\", function()\n    it(\"parses query without filters\", function()\n        -- Verify bd_args and filter table construction\n    end)\n    \n    it(\"extracts status filter from args\", function()\n        -- Verify status moved to filter, removed from bd_args\n    end)\n    \n    it(\"handles plural forms via PLURAL_MAP\", function()\n        -- Verify 'bugs' normalizes to 'bug' in filter\n    end)\n    \n    it(\"errors when no query provided\", function()\n        -- Verify vim.notify called with ERROR level\n    end)\nend)\n```\n\nThese tests ensure the syntactic sugar works correctly following the established list/ready pattern.","status":"closed","priority":3,"issue_type":"task","created_at":"2025-12-06T22:14:42.856029309-07:00","updated_at":"2025-12-07T11:02:14.663824674-07:00","closed_at":"2025-12-07T11:02:14.663824674-07:00","dependencies":[{"issue_id":"nvim-beads-suj","depends_on_id":"nvim-beads-kag","type":"discovered-from","created_at":"2025-12-06T22:14:42.858948177-07:00","created_by":"daemon"},{"issue_id":"nvim-beads-suj","depends_on_id":"nvim-beads-mbx","type":"blocks","created_at":"2025-12-06T22:48:47.655182359-07:00","created_by":"daemon"}]}
{"id":"nvim-beads-xl5","title":"Replace sync bd execution in telescope list() with core.execute_bd()","description":"The telescope list() function (lines 125-137) manually executes bd commands, handles errors, and parses JSON. This duplicates core.execute_bd() functionality. Refactor to use the existing helper.","status":"closed","priority":1,"issue_type":"task","created_at":"2025-12-06T10:56:31.840300758-07:00","updated_at":"2025-12-06T11:01:31.974129666-07:00","closed_at":"2025-12-06T11:01:31.974129666-07:00"}
{"id":"nvim-beads-p69","title":"Implement open_issue_buffer() to fetch and display issues in beads:// buffers","description":"Create the core buffer manager function `open_issue_buffer(issue_id)` in `lua/nvim-beads/issue.lua` that:\n1. Executes `bd show --json \u003cissue_id\u003e` to fetch issue data\n2. Formats the data using the extended formatter\n3. Creates a new buffer with the naming scheme `beads://issue/\u003cissue_id\u003e`\n4. Populates the buffer with formatted content\n5. Configures the buffer with appropriate settings (filetype markdown, buffer options)\n\nThis function serves as the foundation for opening issues from Telescope and from the user command.","status":"closed","priority":1,"issue_type":"task","created_at":"2025-11-30T19:04:38.959352324-07:00","updated_at":"2025-11-30T19:21:24.628665133-07:00","closed_at":"2025-11-30T19:21:24.628665133-07:00","dependencies":[{"issue_id":"nvim-beads-p69","depends_on_id":"nvim-beads-2ry","type":"blocks","created_at":"2025-11-30T19:04:47.455400327-07:00","created_by":"daemon"}]}
{"id":"nvim-beads-kzq","title":"Add support for apply filtering in Beads list","description":"## Feature Request\n\nThe objective is to modify the `Beads list` command to accept zero, one, or two optional arguments corresponding to `[state]` and `[type]`. The Telescope window will then display only the issues that match the specified criteria.\n\n**Command Signature:** `Beads list [state] [type]`\n\n**Examples:**\n*   `Beads list open bugs` (Filters for open bugs)\n*   `Beads list ready` (Filters for issues in the 'ready' state)\n*   `Beads list features` (Filters for issues of type 'feature')\n*   `Beads list` (Shows all issues, current behavior)\n\n## Motivation\n\nFiltering ensures users are able to view the issues they most care about. Having the ability to apply these filters when invoking the command enables users to bind keys to specific sets of desired filters.","status":"closed","priority":1,"issue_type":"feature","created_at":"2025-12-01T22:13:02.725540352-07:00","updated_at":"2025-12-02T21:10:19.100046964-07:00","closed_at":"2025-12-02T21:10:19.100046964-07:00","dependencies":[{"issue_id":"nvim-beads-kzq","depends_on_id":"nvim-beads-q2g","type":"blocks","created_at":"2025-12-01T22:13:02.740266654-07:00","created_by":"daemon"},{"issue_id":"nvim-beads-kzq","depends_on_id":"nvim-beads-tjz","type":"blocks","created_at":"2025-12-01T22:13:02.743692708-07:00","created_by":"daemon"},{"issue_id":"nvim-beads-kzq","depends_on_id":"nvim-beads-2s7","type":"blocks","created_at":"2025-12-01T22:13:02.744634856-07:00","created_by":"daemon"},{"issue_id":"nvim-beads-kzq","depends_on_id":"nvim-beads-6p1","type":"blocks","created_at":"2025-12-01T22:13:02.745569341-07:00","created_by":"daemon"},{"issue_id":"nvim-beads-kzq","depends_on_id":"nvim-beads-7nn","type":"blocks","created_at":"2025-12-01T22:13:02.746393136-07:00","created_by":"daemon"}]}
{"id":"nvim-beads-fix","title":"Add core.execute_bd_async() helper function","description":"Create an async version of core.execute_bd() that takes a callback. This will allow us to consolidate the async bd command execution logic currently duplicated across telescope action handlers.","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-06T10:56:40.415823499-07:00","updated_at":"2025-12-06T11:04:32.103096655-07:00","closed_at":"2025-12-06T11:04:32.103096655-07:00"}
{"id":"nvim-beads-3tp","title":"Create test_utilities/assertions.lua with common assertion helpers","description":"Many tests duplicate assertion patterns, especially for error notifications and bd command validation.\n\nPattern appears 20+ times across test files:\n```lua\nlocal notified = false\nlocal notify_msg = nil\nvim.notify = function(msg, _)\n    notified = true\n    notify_msg = msg\nend\n-- ... call function\nassert.is_true(notified)\nassert.matches(\"pattern\", notify_msg)\n```\n\nCreating shared assertion helpers will eliminate 150-250 lines of duplicate code.","status":"closed","priority":1,"issue_type":"task","created_at":"2025-12-07T18:15:36.894218997-07:00","updated_at":"2025-12-07T19:31:31.474343253-07:00","closed_at":"2025-12-07T19:31:31.474343253-07:00"}
{"id":"nvim-beads-1uj","title":"Add integration tests for search functionality","description":"## Context\n\nWith the execute infrastructure in place (commit 5f0ea69c), search uses execute_with_ui which routes to Telescope via the TELESCOPE_COMMANDS whitelist. Testing should follow the pattern established for list/ready commands.\n\n## Implementation\n\nWrite integration tests that verify the full search flow following the list/ready test pattern (see spec/nvim-beads/execute_spec.lua for reference):\n\n**Test areas:**\n1. **bd_args construction:**\n   - Mock bd execution via core.execute_bd\n   - Verify bd_args passed correctly: `{'search', 'query', 'terms'}`\n   - Verify --json flag added automatically\n\n2. **Filter application:**\n   - Verify status filter passed to Telescope extension: `filter={status='open'}`\n   - Verify type filter passed to Telescope extension: `filter={type='bug'}`\n   - Verify combined filters: `filter={status='open', type='bug'}`\n\n3. **Routing to Telescope:**\n   - Mock execute_with_ui to verify 'search' routes to show_issues (not terminal buffer)\n   - Verify search is in TELESCOPE_COMMANDS whitelist\n\n4. **Error handling:**\n   - bd command failures (exit code ≠ 0)\n   - Empty results (valid JSON, empty array)\n   - Invalid JSON from bd command\n\n**Test structure:**\n```lua\ndescribe(\"search functionality\", function()\n    it(\"builds correct bd_args for simple query\", function()\n        -- Verify {'search', 'foo', 'bar'} passed to execute_bd\n    end)\n    \n    it(\"applies client-side status filter\", function()\n        -- Verify filter={status='open'} passed to Telescope\n    end)\n    \n    it(\"routes to Telescope, not terminal buffer\", function()\n        -- Verify TELESCOPE_COMMANDS['search'] == true\n        -- Verify execute_with_ui calls show_issues\n    end)\n    \n    it(\"handles bd command failures\", function()\n        -- Mock execute_bd to return error\n        -- Verify error shown to user\n    end)\nend)\n```\n\nThese ensure the init.search() and commands.search integration works end-to-end using the execute infrastructure.","status":"closed","priority":3,"issue_type":"task","created_at":"2025-12-06T22:14:43.299615925-07:00","updated_at":"2025-12-07T11:03:00.400658329-07:00","closed_at":"2025-12-07T11:03:00.400658329-07:00","dependencies":[{"issue_id":"nvim-beads-1uj","depends_on_id":"nvim-beads-kag","type":"discovered-from","created_at":"2025-12-06T22:14:43.30163321-07:00","created_by":"daemon"},{"issue_id":"nvim-beads-1uj","depends_on_id":"nvim-beads-mbx","type":"blocks","created_at":"2025-12-06T22:48:48.644608775-07:00","created_by":"daemon"}]}
{"id":"nvim-beads-3q2","title":"Split commands_spec.lua into focused test files","description":"commands_spec.lua is 1,090 lines containing 4 unrelated test suites. After deduplication and migration to env.lua, it should be ~600 lines, but still needs to be split for maintainability.\n\nCurrent structure:\n1. diff tests (lines 1-501) - may already be removed if deduplication chose diff_spec.lua\n2. Search command tests (lines 504-692)\n3. execute_with_ui tests (lines 695-948)\n4. List/ready command tests (lines 951-1090)\n\nTarget structure:\n- spec/nvim-beads/issue/diff_spec.lua (already exists OR moved from commands_spec)\n- spec/nvim-beads/commands/search_spec.lua (new)\n- spec/nvim-beads/core/execute_with_ui_spec.lua (new)\n- spec/nvim-beads/commands/list_and_ready_spec.lua (new)","status":"open","priority":2,"issue_type":"task","created_at":"2025-12-07T18:15:45.613864679-07:00","updated_at":"2025-12-07T18:15:45.613864679-07:00","dependencies":[{"issue_id":"nvim-beads-3q2","depends_on_id":"nvim-beads-303","type":"blocks","created_at":"2025-12-07T18:16:26.946025729-07:00","created_by":"daemon"},{"issue_id":"nvim-beads-3q2","depends_on_id":"nvim-beads-as6","type":"blocks","created_at":"2025-12-07T18:16:27.290056848-07:00","created_by":"daemon"}]}
{"id":"nvim-beads-6p1","title":"Implement special handling for 'ready' state filter","description":"This task implements the special data-fetching logic required for the 'ready' state, which uses a more efficient command.","status":"closed","priority":3,"issue_type":"feature","created_at":"2025-12-01T21:44:12.922578644-07:00","updated_at":"2025-12-02T21:03:41.670654069-07:00","closed_at":"2025-12-02T21:03:41.670654069-07:00"}
{"id":"nvim-beads-1wq","title":"Remove \u003cPlug\u003e mappings from plugin/nvim-beads.lua","description":"Delete the \u003cPlug\u003e(BeadsList) and \u003cPlug\u003e(BeadsReady) mappings. They're redundant now that users can bind directly to Lua API functions or use \u003ccmd\u003e with Vim commands.","status":"closed","priority":1,"issue_type":"task","created_at":"2025-12-06T11:50:28.85478327-07:00","updated_at":"2025-12-06T13:16:22.677574115-07:00","closed_at":"2025-12-06T13:16:22.677574115-07:00","dependencies":[{"issue_id":"nvim-beads-1wq","depends_on_id":"nvim-beads-4gh","type":"parent-child","created_at":"2025-12-06T11:50:28.866100571-07:00","created_by":"daemon"},{"issue_id":"nvim-beads-1wq","depends_on_id":"nvim-beads-9sa","type":"blocks","created_at":"2025-12-06T11:50:50.088560233-07:00","created_by":"daemon"}]}
{"id":"nvim-beads-7st","title":"Implement :checkhealth nvim-beads integration","description":"Neovim provides a `:checkhealth` system for plugins to report on their configuration and dependencies. This feature will implement health checks for nvim-beads to help users diagnose issues with their setup.\n\nThe health check should verify that all required dependencies are installed and configured correctly, following Neovim's health check conventions.","status":"closed","priority":2,"issue_type":"feature","created_at":"2025-12-02T22:33:15.202285632-07:00","updated_at":"2025-12-02T22:42:54.201815421-07:00","closed_at":"2025-12-02T22:42:54.201815421-07:00"}
{"id":"nvim-beads-bec","title":"Add core.show_issues() and core.execute_with_ui() infrastructure","description":"Add centralized infrastructure in lua/nvim-beads/core.lua for executing bd commands with smart UI routing.\n\nKey additions:\n- TELESCOPE_COMMANDS whitelist constant: {'list', 'search', 'blocked', 'ready'}\n- M.show_issues(bd_args, opts): Loads Telescope extension and calls show_issues with bd_args and filter options\n- M.execute_with_ui(args, opts): Routes to Telescope if command in whitelist, otherwise executes in terminal via util.execute_command_in_scratch_buffer()\n\nAcceptance criteria:\n- Commands in whitelist display in Telescope\n- Commands not in whitelist execute in terminal buffer\n- bd_args preserved for Telescope refresh","status":"closed","issue_type":"task","created_at":"2025-12-06T22:47:23.729823835-07:00","updated_at":"2025-12-06T23:44:46.931233-07:00","closed_at":"2025-12-06T23:44:46.931233-07:00","dependencies":[{"issue_id":"nvim-beads-bec","depends_on_id":"nvim-beads-7g8","type":"blocks","created_at":"2025-12-06T22:48:28.749837346-07:00","created_by":"daemon"}]}
{"id":"nvim-beads-ku4","title":"Fix Beads create when no template is available","description":"'Beads create \u003ctype\u003e' takes an issue type and looks up a template, but there may not be a template specified for that type. We need to handle this case.","status":"closed","issue_type":"bug","created_at":"2025-12-01T22:20:41.546027389-07:00","updated_at":"2025-12-02T17:51:28.934542777-07:00","closed_at":"2025-12-02T17:51:28.934542777-07:00"}
{"id":"nvim-beads-loc","title":"Create Centralized Mock Environment Helper","description":"**Observation:**\nSignificant code duplication exists across multiple spec files (`autocmd_integration_spec.lua`, `issue_spec.lua`, `new_issue_buffer_spec.lua`) for mocking Neovim APIs (`vim.api.*`, `vim.notify`, `vim.system`). This makes tests verbose, hard to maintain, and brittle.\n\n**Recommendation:**\nCreate a new test utility (e.g., `spec/test_utilities/env.lua`) to provide a reusable function for setting up and tearing down a fully mocked test environment. This will centralize mocking logic, reduce boilerplate, and improve maintainability.\n\n**Validation Steps:**\n1. Create the new `spec/test_utilities/env.lua` module.\n2. Refactor one of the affected files, like `spec/nvim-beads/new_issue_buffer_spec.lua`, to use the new helper.\n3. Verify that all tests in the refactored file still pass.\n4. Apply the same refactoring to other affected spec files (`autocmd_integration_spec.lua`, `issue_spec.lua`).","status":"closed","priority":3,"issue_type":"task","created_at":"2025-12-01T21:03:50.380989559-07:00","updated_at":"2025-12-02T20:29:46.055395457-07:00","closed_at":"2025-12-02T20:29:46.055395457-07:00"}
{"id":"nvim-beads-nu7","title":"Create :BeadsOpenIssue command for direct issue buffer access","description":"Add a new user command `:BeadsOpenIssue \u003cid\u003e` that provides direct access to opening an issue buffer without going through the Telescope picker.\n\nThis command:\n- Takes a single required argument (the issue ID)\n- Calls `open_issue_buffer()` with the provided ID\n- Provides a faster workflow when the user knows the exact issue ID they want to open\n\nThe command should be defined in `lua/nvim-beads/commands.lua` or the appropriate commands module.","status":"closed","priority":1,"issue_type":"task","created_at":"2025-11-30T19:04:41.062294051-07:00","updated_at":"2025-11-30T20:05:25.469632564-07:00","closed_at":"2025-11-30T20:05:25.469632564-07:00","dependencies":[{"issue_id":"nvim-beads-nu7","depends_on_id":"nvim-beads-p69","type":"blocks","created_at":"2025-11-30T19:04:47.723922536-07:00","created_by":"daemon"}]}
{"id":"nvim-beads-3ip","title":"Implement core bd executor","description":"Create an async function in lua/nvim-beads/core.lua to execute bd commands via vim.system, parse JSON output, and handle errors properly.","status":"closed","priority":1,"issue_type":"task","created_at":"2025-11-30T17:08:46.96819693-07:00","updated_at":"2025-11-30T17:53:01.981349049-07:00","closed_at":"2025-11-30T17:53:01.981349049-07:00","dependencies":[{"issue_id":"nvim-beads-3ip","depends_on_id":"nvim-beads-7zt","type":"blocks","created_at":"2025-11-30T17:09:19.586232116-07:00","created_by":"daemon"}]}
{"id":"nvim-beads-5ia","title":"Add Enter key mapping to navigate to referenced issue IDs in beads buffers","description":"## Feature Request\n\nWhen editing a beads issue buffer (e.g., `beads://issue/nvim-beads-123`), add a normal mode mapping for `\u003cCR\u003e` (Enter key) that:\n1. Examines the text under the cursor\n2. If it matches an issue ID pattern (based on the prefix used in the current repository), execute the equivalent of `:Beads show \u003cissue-id\u003e` to open that referenced issue\n\n## Motivation\n\nIssue buffers frequently reference other issues in:\n- The `parent:` field in YAML frontmatter\n- The `dependencies:` list in YAML frontmatter  \n- The description, design notes, or acceptance criteria sections\n\nCurrently, navigating to these referenced issues requires manually copying the ID and running `:Beads show \u003cid\u003e`. This breaks flow and is tedious. A simple Enter-to-follow mapping would make navigating issue relationships much more ergonomic.\n\n## Use Cases\n\n1. **Following parent issues**: User is viewing a subtask and wants to see the parent epic - cursor on `parent: nvim-beads-42`, press Enter, parent issue opens\n2. **Checking dependencies**: User is reviewing blocked work and wants to see what's blocking it - cursor on a dependency ID in the list, press Enter, dependency opens\n3. **Exploring design references**: Description mentions \"see nvim-beads-7 for background\" - cursor on the ID, press Enter, background issue opens","status":"closed","priority":2,"issue_type":"feature","created_at":"2025-12-07T13:19:31.035710657-07:00","updated_at":"2025-12-07T14:21:26.804544272-07:00","closed_at":"2025-12-07T14:21:26.804544272-07:00"}
{"id":"nvim-beads-akf","title":"Implement issue formatter with full metadata","description":"Implement format_issue_to_markdown(issue) function in lua/nvim-beads/issue.lua that converts a bd issue table into a list of strings representing YAML frontmatter followed by Markdown body content.","status":"closed","priority":1,"issue_type":"task","created_at":"2025-11-30T18:24:30.526515502-07:00","updated_at":"2025-11-30T18:45:29.556289743-07:00","closed_at":"2025-11-30T18:45:29.556289743-07:00","dependencies":[{"issue_id":"nvim-beads-akf","depends_on_id":"nvim-beads-d59","type":"blocks","created_at":"2025-11-30T18:24:45.997831096-07:00","created_by":"daemon"}]}
{"id":"nvim-beads-czj","title":"Telescope preview collapses blank lines in issue body","description":"## Summary\n\nThe issue preview in the Telescope picker for \"Beads list\" incorrectly collapses blank lines from the issue's description and other multi-line text fields. When an issue is opened in a full buffer, the blank lines are preserved, leading to an inconsistent presentation of the content.\n\n## Steps to Reproduce\n\n1. Create a new issue with a description that contains blank lines (e.g., \"Line 1\\n\\nLine 3\").\n2. Run `:Telescope nvim_beads list`.\n3. Observe the preview for the newly created issue. The blank line between \"Line 1\" and \"Line 3\" is missing.\n4. Select the issue to open it in a full buffer.\n5. Observe that the blank line is correctly displayed in the full buffer.\n\n## Expected Behavior\n\nThe Telescope preview should render the issue body exactly as it appears in the full issue view, including any blank lines.\n\n## Actual Behavior\n\nThe Telescope preview collapses multiple consecutive newlines into a single one, effectively removing blank lines.\n\n## Root Cause Analysis\n\nThe root cause of this bug is in the `create_issue_previewer` function within `lua/telescope/_extensions/nvim_beads/init.lua`. The code responsible for splitting lines containing newlines uses the following logic:\n\n```lua\nfor subline in line:gmatch(\"[^\\n]+\") do\n    table.insert(flattened_lines, subline)\nend\n```\n\nThe pattern `[^\\n]+` matches one or more non-newline characters. When it encounters a blank line (which is essentially two consecutive newline characters `\\n\\n`), there are no characters between the newlines for the pattern to match, so the blank line is skipped.\n\nIn contrast, the `open_issue_buffer` function in `lua/nvim-beads/issue.lua` uses a more robust method to split lines while preserving blank lines, which is why the full issue view is correct.","status":"closed","issue_type":"bug","created_at":"2025-12-01T21:11:23.204504016-07:00","updated_at":"2025-12-02T17:38:38.532873799-07:00","closed_at":"2025-12-02T17:38:38.532873799-07:00"}
{"id":"nvim-beads-zii","title":"Implement Telescope hotkey to mark issues as in-progress","description":"Create a feature to allow users to mark a selected `beads` issue as \"in_progress\" directly from the Telescope issue list.\n\n**Implementation Details**:\n-   **Telescope Custom Mapping**: Add a normal mode keymap ('i') within the `beads` Telescope picker.\n-   **Selected Entry Retrieval**: The Lua function will retrieve the currently selected issue entry from the Telescope picker using `require('telescope.actions.state').get_selected_entry()`.\n-   **User Confirmation**: A confirmation dialog via `vim.fn.confirm()` must be shown before changing the status.\n-   **Asynchronous Update**: Upon confirmation, execute `bd update \u003cissue_id\u003e --status in_progress --json` using `vim.system()`.\n-   **Picker Refresh**: After a successful update, the Telescope picker list must be refreshed to reflect the status change.","status":"closed","priority":1,"issue_type":"feature","created_at":"2025-12-02T21:24:54.00908819-07:00","updated_at":"2025-12-02T21:42:20.676796352-07:00","closed_at":"2025-12-02T21:42:20.676796352-07:00"}
{"id":"nvim-beads-wq2","title":"Beads command centralization","description":"As a Neovim user, I want all nvim-beads commands collected as subcommands\nunder the Beads main command so that I have a consistent command pattern\nI can learn.\n\n## Feature Request\n\nBroadly speaking, Vim/Neovim plugins are moving to a model with a single\nmain command (e.g. 'Git' in fugitive, 'Telescope' in telescope, etc) with\nsub-commands.\n\nThis project started off by building multiple main commands, which isn't\ndesirable, so the goal of this ticket is to fix that, centralizing all\nthose commands under the Beads command.","status":"closed","priority":2,"issue_type":"feature","created_at":"2025-11-30T22:25:14.528911332-07:00","updated_at":"2025-11-30T22:26:56.258921296-07:00","closed_at":"2025-11-30T22:26:56.258921296-07:00"}
{"id":"nvim-beads-on7","title":"Update telescope extension to use public API","description":"Refactor lua/telescope/_extensions/nvim_beads/init.lua to use require(\"nvim-beads\").show() instead of directly calling internal buffer module.","status":"closed","priority":1,"issue_type":"task","created_at":"2025-12-06T11:50:28.685097125-07:00","updated_at":"2025-12-06T13:13:33.636591194-07:00","closed_at":"2025-12-06T13:13:33.636591194-07:00","dependencies":[{"issue_id":"nvim-beads-on7","depends_on_id":"nvim-beads-4gh","type":"parent-child","created_at":"2025-12-06T11:50:28.696147161-07:00","created_by":"daemon"},{"issue_id":"nvim-beads-on7","depends_on_id":"nvim-beads-9sa","type":"blocks","created_at":"2025-12-06T11:50:49.96872362-07:00","created_by":"daemon"}]}
{"id":"nvim-beads-1x2","title":"Document search command and API in help docs","description":"## Context\n\nWith the search functionality being built on the execute infrastructure (commit 5f0ea69c), we need comprehensive documentation for both the `:Beads search` command and the `search()` public API.\n\n## Files to Update\n\n1. **doc/nvim-beads.txt** - Main help documentation\n2. **README.md** - User-facing documentation (if search is mentioned)\n3. **doc/beads-execute.txt** - May need minor updates to mention search as an example\n\n## Documentation Sections Needed\n\n### 1. Command Documentation (doc/nvim-beads.txt)\n\nAdd `:Beads search` command documentation following the pattern of `:Beads list` and `:Beads ready`:\n\n```\n:Beads search {query}                                    *:Beads-search*\n    Search for issues matching {query}. The query can be multiple words.\n    \n    Optional filters can be placed before the query:\n    - Status filter: open, closed, in_progress, blocked\n    - Type filter: bug, bugs, feature, features, task, tasks, epic, epics, chore, chores\n    \n    Examples: \u003e\n        :Beads search refactor database\n        :Beads search open refactor database\n        :Beads search bugs authentication\n        :Beads search open bugs login\n\u003c\n    Results are displayed in a Telescope picker with the same keybindings\n    as |:Beads-list|.\n    \n    Syntactic sugar: Status and type filters can appear anywhere before\n    the query terms and in any order.\n```\n\n### 2. Public API Documentation (doc/nvim-beads.txt)\n\nAdd `search()` function documentation in the Lua API section:\n\n```\nnvim_beads.search({query}, {opts})                       *nvim_beads.search()*\n    Search for issues matching {query}.\n    \n    Parameters: ~\n        {query}  (string) Search query (required, must be non-empty)\n        {opts}   (table|nil) Optional filters:\n                   • status: Filter by status (e.g., \"open\", \"closed\")\n                   • type: Filter by issue type (e.g., \"bug\", \"feature\")\n    \n    Examples: \u003e\n        require('nvim-beads').search('database migration')\n        require('nvim-beads').search('authentication', {status = 'open'})\n        require('nvim-beads').search('login bug', {type = 'bug', status = 'open'})\n\u003c\n    See also: |nvim_beads.list()|, |nvim_beads.execute_with_ui()|\n```\n\n### 3. Execute Command Documentation Updates\n\nUpdate **doc/beads-execute.txt** to include search as a prominent example:\n\n```\nExamples: \u003e\n    :Beads execute list --status open\n    :Beads execute search authentication bug\n    :Beads execute ready --priority 1\n    :Beads execute show bd-123\n\u003c\n```\n\n### 4. README Updates\n\nIf README.md mentions available commands, add search:\n\n```markdown\n- `:Beads search {query}` - Search for issues (with optional status/type filters)\n```\n\n## Key Points to Document\n\n1. **Query is required** - Unlike list/ready, search must have query terms\n2. **Filter flexibility** - Filters can appear anywhere before query terms\n3. **Plural forms supported** - 'bugs' works the same as 'bug'\n4. **Telescope integration** - Results appear in same picker as list/ready\n5. **Relationship to execute** - Mention that `search` can also be used via `:Beads execute search ...`\n\n## Acceptance Criteria\n\n- [ ] `:Beads search` command documented in doc/nvim-beads.txt\n- [ ] `nvim_beads.search()` API documented in doc/nvim-beads.txt\n- [ ] Examples show both simple and filtered searches\n- [ ] Examples show filter order flexibility\n- [ ] Cross-references to related commands (list, ready, execute)\n- [ ] Error cases documented (missing query)\n- [ ] README updated if it lists commands\n- [ ] Help tags work (`:help :Beads-search`, `:help nvim_beads.search()`)\n\n## References\n\n- See nvim-beads-766 for pattern of documenting public API\n- See existing `:Beads list` documentation for command doc pattern\n- See doc/beads-execute.txt for execute command documentation","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-07T10:14:33.334018768-07:00","updated_at":"2025-12-07T10:22:28.271533435-07:00","closed_at":"2025-12-07T10:22:28.271533435-07:00","dependencies":[{"issue_id":"nvim-beads-1x2","depends_on_id":"nvim-beads-azf","type":"blocks","created_at":"2025-12-07T10:14:33.344941379-07:00","created_by":"daemon"},{"issue_id":"nvim-beads-1x2","depends_on_id":"nvim-beads-mbx","type":"blocks","created_at":"2025-12-07T10:14:33.346967228-07:00","created_by":"daemon"}]}
{"id":"nvim-beads-60i","title":"Add support for 'compact', 'cleanup', and 'sync' operations","description":"This feature will introduce support for several `bd` commands that are intended to be run and have their output displayed to the user. The commands to be implemented are `compact`, `cleanup`, and `sync`.\n\nThe implementation should be generic enough to easily add more pass-through commands in the future. The behavior should be similar to `vim-fugitive`'s `:Git` command, where the command and its arguments are passed directly to the underlying `bd` tool, and the output is displayed in a new scratch buffer.","status":"closed","priority":2,"issue_type":"feature","created_at":"2025-12-02T22:10:02.275585785-07:00","updated_at":"2025-12-02T22:30:14.169912659-07:00","closed_at":"2025-12-02T22:30:14.169912659-07:00"}
{"id":"nvim-beads-ypo","title":"Adopt assertion helpers across all test files","description":"After creating test_utilities/assertions.lua, migrate existing tests to use the new helpers.\n\nTarget files with heavy assertion duplication:\n- commands_spec.lua or its split files (error notifications, bd commands)\n- init_spec.lua (error notifications)\n- core_spec.lua (error notifications, bd commands)\n- diff_spec.lua (bd commands)\n- All other test files as applicable\n\nEstimated savings: 250-450 lines across all files.","status":"open","priority":2,"issue_type":"task","created_at":"2025-12-07T18:15:47.973918627-07:00","updated_at":"2025-12-07T18:15:47.973918627-07:00","dependencies":[{"issue_id":"nvim-beads-ypo","depends_on_id":"nvim-beads-3tp","type":"blocks","created_at":"2025-12-07T18:16:28.00513225-07:00","created_by":"daemon"},{"issue_id":"nvim-beads-ypo","depends_on_id":"nvim-beads-pkk","type":"blocks","created_at":"2025-12-07T18:16:28.357852147-07:00","created_by":"daemon"}]}
{"id":"nvim-beads-ctb","title":"Refactor core.lua to be a pure service layer for the bd CLI","description":"### Observation\n\nThe `core.lua` module is intended to be a low-level service layer that provides a clean interface to the `bd` command-line tool. However, it contains the `create_issue` function, which is higher-level application logic. This function orchestrates fetching a template and then opening a new Neovim buffer, which goes beyond the module's primary responsibility of simply executing `bd` commands.\n\n### Recommendation\n\nRefactor `core.lua` to be a pure service layer by relocating the orchestration logic.\n\n1.  Move the implementation logic from `core.create_issue` into the `impl` function for the `create` subcommand, located in `lua/nvim-beads/commands.lua`.\n2.  The `impl` function in `commands.lua` will now be responsible for calling `core.fetch_template` and `issue.open_new_issue_buffer` (or its new location after refactoring `issue.lua`).\n3.  Remove the `create_issue` function from `core.lua` entirely.\n\n### Verification\n\n1.  All existing unit tests should pass. Test files like `spec/nvim-beads/commands_spec.lua` and `spec/nvim-beads/core_spec.lua` may require updates to reflect the moved logic.\n2.  Manually test the `:Beads create \u003ctype\u003e` command (e.g., `:Beads create feature`). The command should successfully fetch the correct template and open a new, pre-filled issue buffer as before.","status":"closed","priority":3,"issue_type":"task","created_at":"2025-12-01T20:52:10.131024674-07:00","updated_at":"2025-12-02T18:23:13.236248556-07:00","closed_at":"2025-12-02T18:23:13.236248556-07:00"}
{"id":"nvim-beads-4y7","title":"Implement Command Generation with Tests","description":"Implement the command generation logic that converts a list of changes (from the diff function) into the appropriate `bd` CLI commands to apply those changes.\n\nThis is a pure function that takes the structured changes and generates a list of executable `bd` commands following the CLI mapping defined in the detailed requirements.","status":"closed","priority":1,"issue_type":"task","created_at":"2025-11-30T20:11:03.665813837-07:00","updated_at":"2025-11-30T20:43:03.232424293-07:00","closed_at":"2025-11-30T20:43:03.232424293-07:00","dependencies":[{"issue_id":"nvim-beads-4y7","depends_on_id":"nvim-beads-v3m","type":"blocks","created_at":"2025-11-30T20:11:24.541079301-07:00","created_by":"daemon"}]}
{"id":"nvim-beads-77q","title":"Support :e and :e! commands to reload beads buffers from authoritative source","description":"## Feature Request\n\nEnable `:e` and `:e!` commands to work in beads issue buffers (`beads://issue/\u003cid\u003e`) to reload the issue from bd's authoritative data.\n\n- `:e` - reload if buffer unmodified, show error if modified\n- `:e!` - force reload, discarding any unsaved changes\n\n## Motivation\n\nWhen an issue is modified outside the current buffer (e.g., by another user, an LLM agent, or a CLI command), the buffer becomes stale. Users need a standard, Vim-native way to refresh the buffer content without closing and reopening it.\n\nThe `:e` family of commands is the idiomatic way to reload buffers in Vim. Supporting this for beads buffers provides a familiar UX.\n\n## Use Cases\n\n1. **LLM updates**: Agent updates an issue via bd CLI, user wants to see changes without closing buffer\n2. **Collaborative editing**: Multiple users/agents working on issues, need to sync latest state\n3. **Undo mistakes**: User made edits they want to discard, `:e!` reverts to saved state\n4. **Checking for changes**: User suspects issue was updated externally, `:e` to refresh\n\n## Proposed Solution\n\nIntercept buffer read commands for beads:// URIs and reload from bd using existing `reload_buffer_from_issue_id()` function in buffer.lua.","status":"closed","priority":2,"issue_type":"feature","created_at":"2025-12-07T13:39:51.569177153-07:00","updated_at":"2025-12-07T14:02:46.753956714-07:00","closed_at":"2025-12-07T14:02:46.753956714-07:00"}
{"id":"nvim-beads-azf","title":"Add public search() API to init.lua","description":"## Context\n\nWith the execute infrastructure now in place (commit 5f0ea69c), search should follow the same pattern as list() and ready() in init.lua.\n\n## Implementation\n\nAdd M.search(query, opts) function to lua/nvim-beads/init.lua that:\n\n**Function signature:**\n```lua\nfunction M.search(query, opts)\n```\n\n**Implementation pattern (following list/ready):**\n1. Validate query is non-empty string\n2. Build bd_args: `{'search', query}` (split query into words if needed for bd CLI)\n3. Build filter table from opts:\n   - `filter.status = opts.status` (if provided)\n   - `filter.type = opts.type` (if provided)\n4. Call `M.execute_with_ui(bd_args, filter)`\n\n**Key technical details:**\n- Since 'search' is in TELESCOPE_COMMANDS whitelist (core.lua:7-12), execute_with_ui will automatically route to Telescope\n- Client-side filters (status, type) will be applied by Telescope extension\n- This provides the programmatic API for search functionality\n\n**Example usage:**\n```lua\nrequire('nvim-beads').search('foo bar', {status = 'open', type = 'bug'})\n```\n\nThis exposes search functionality to users and other plugins following the same pattern as list() and ready().","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-06T22:14:42.399913799-07:00","updated_at":"2025-12-07T10:20:09.98561603-07:00","closed_at":"2025-12-07T10:20:09.98561603-07:00","dependencies":[{"issue_id":"nvim-beads-azf","depends_on_id":"nvim-beads-kag","type":"blocks","created_at":"2025-12-06T22:49:22.30644477-07:00","created_by":"daemon"}]}
{"id":"nvim-beads-a9s","title":"Implement create command generation logic","description":"Implement the logic to generate the `bd create` command string from parsed buffer content. This function needs to construct the command with all relevant flags based on what fields are populated in the new issue buffer.\n\nThe command must handle the required title field and optional fields like priority, description, acceptance criteria, design, labels, parent, and dependencies.\n\nThis is part of Iteration 5: Create New Issues from the implementation plan.","status":"closed","priority":1,"issue_type":"task","created_at":"2025-11-30T21:05:42.594170273-07:00","updated_at":"2025-11-30T21:24:54.353618726-07:00","closed_at":"2025-11-30T21:24:54.353618726-07:00"}
{"id":"nvim-beads-23q","title":"Create test_utilities/factory.lua for test data generation","description":"Many tests create issue objects and command tables with repetitive boilerplate.\n\nCreating a factory pattern will:\n- Reduce 100-200 lines of test setup code\n- Make tests more readable\n- Ensure consistent test data structure\n- Make it easy to create variations (open issue, closed issue, etc.)","status":"open","priority":2,"issue_type":"task","created_at":"2025-12-07T18:15:42.111939268-07:00","updated_at":"2025-12-07T18:15:42.111939268-07:00"}
